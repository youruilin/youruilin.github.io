<!DOCTYPE html><html lang="[&quot;ja&quot;,&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]" data-theme="light"><head><style>:root {
  --article-theme-color: #e5a80d;
}</style><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>双招项目后端api全过程实现 | iooio_blog</title><meta name="author" content="游瑞林"><meta name="copyright" content="游瑞林"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content=".ai-summary-active .ai-summary-icon-title text:first-of-type {         display: none !important;       }        .ai-summary-active .ai-summary-icon-title text:last-child {         disp">
<meta property="og:type" content="article">
<meta property="og:title" content="双招项目后端api全过程实现">
<meta property="og:url" content="https://youruilin.github.io/posts/629f32c0/index.html">
<meta property="og:site_name" content="iooio_blog">
<meta property="og:description" content=".ai-summary-active .ai-summary-icon-title text:first-of-type {         display: none !important;       }        .ai-summary-active .ai-summary-icon-title text:last-child {         disp">
<meta property="og:locale" content="ja_JP">
<meta property="og:image" content="http://lychee.iooio.cn:9527/uploads/medium/38/53/e2ec8d2bd090dd1321fa01254923.png">
<meta property="article:published_time" content="2024-12-29T10:15:00.000Z">
<meta property="article:modified_time" content="2025-07-22T10:21:09.000Z">
<meta property="article:author" content="游瑞林">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="api">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lychee.iooio.cn:9527/uploads/medium/38/53/e2ec8d2bd090dd1321fa01254923.png"><link rel="shortcut icon" href="/img/favicon_io/android-chrome-192x192.png"><link rel="canonical" href="https://youruilin.github.io/posts/629f32c0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>(()=>{
      const saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      
      window.btf = {
        saveToLocal: saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          script.onerror = reject
          script.onload = script.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            script.onload = script.onreadystatechange = null
            resolve()
          }

          Object.keys(attr).forEach(key => {
            script.setAttribute(key, attr[key])
          })

          document.head.appendChild(script)
        }),

        getCSS: (url, id = false) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onerror = reject
          link.onload = link.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            link.onload = link.onreadystatechange = null
            resolve()
          }
          document.head.appendChild(link)
        }),

        addGlobalFn: (key, fn, name = false, parent = window) => {
          const pjaxEnable = true
          if (!pjaxEnable && key.startsWith('pjax')) return

          const globalFn = parent.globalFn || {}
          const keyObj = globalFn[key] || {}
    
          if (name && keyObj[name]) return
    
          name = name || Object.keys(keyObj).length
          keyObj[name] = fn
          globalFn[key] = keyObj
          parent.globalFn = globalFn
        }
      }
    
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode
      
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"${query} の検索結果が見つかりませんでした。","hits_stats":"${hits} 件の記事が見つかりました"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'コピー成功',
    error: 'コピー失敗',
    noSupport: 'ブラウザが対応していません'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '日',
  dateSuffix: {
    just: 'たった今',
    min: '分前',
    hour: '時間前',
    day: '日前',
    month: 'ヶ月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"繁体字に切り替えました","cht_to_chs":"簡体字に切り替えました","day_to_night":"ダークモードに切り替えました","night_to_day":"ライトモードに切り替えました","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'もっと見る'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '双招项目后端api全过程实现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-22 10:21:09'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4684778_zddxn068xgp.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/theme-chalk/index.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/progress_bar.css" media="defer" onload="this.media='all'"><span id="fps"></span><link rel="stylesheet" href="/css/tooltip.css" media="defer" onload="this.media='all'"><div id="myscoll"></div><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="an_music_bg">    </div><div id="web_bg" style="background-image: url(https://raw.githubusercontent.com/youruilin/pic_bed/main/bcg_img/index_test.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/butterfly-icon.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">記事</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">タグ</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">カテゴリ</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-home faa-tada"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="fa-fw fas fa-tags faa-tada"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw fas fa-link faa-tada"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat faa-tada"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="fa-fw fas fa-music faa-tada"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><i class="fa-fw fas fa-images faa-tada"></i><span> 照片</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="fa-fw fas fa-video faa-tada"></i><span> 电影</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="fa-fw fas fa-laptop faa-tada"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw fas fa-heart faa-tada"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-language faa-tada"></i><span> 语言</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fas fa-c faa-tada"></i><span> 中文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/jp/"><i class="fa-fw fas fa-j faa-tada"></i><span> 日本語</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://butterfly.js.org/en/"><i class="fa-fw fas fa-e faa-tada"></i><span> English</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(http://lychee.iooio.cn:9527/uploads/medium/38/53/e2ec8d2bd090dd1321fa01254923.png);"><nav id="nav"><span id="blog-info"><a href="/" title="iooio_blog"><span id="site-name">iooio_blog</span></a><div class="back-home-button" tabindex="-1"><i class="back-home-button-icon fas fa-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://youruilin.github.io/Hexo_nav/" title="前往个人导航" target="_blank" one-link-mark="yes"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/original/03/a7/945ec4715b14d857227aa23429f7.webp"/><span class="back-menu-item-text">个人导航</span></a><a class="back-menu-item" href="/" rel="external nofollow" title="博客主页" target="_blank" one-link-mark="yes"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/original/27/37/cba78cfecaff456df3d2f40a4ded.webp" style="width: 30px; height: 30px;"/><span class="back-menu-item-text">博客主页</span></a><a class="back-menu-item" href="https://youruilin.github.io/index_blog/" rel="external nofollow" title="前往个人主页" target="_blank" one-link-mark="yes"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img02.anheyu.com/adminuploads/1/2022/04/27/6268e7d9de532.png"/><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="http://lychee.iooio.cn:9527/" rel="external nofollow" title="lychee" target="_blank" one-link-mark="yes"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/original/3d/44/667fa779ad75e6062e263075a028.webp"/><span class="back-menu-item-text">lychee图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="前往博客主页" target="_blank" one-link-mark="yes"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/original/3e/33/45b5e9c7796e9940d0351db5aeb5.webp"/><span class="back-menu-item-text">博客</span></a></div></div></div></div></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-home faa-tada"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fas fa-home faa-tada"></i><span> 首页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="fa-fw fas fa-tags faa-tada"></i><span> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="fa-fw fas fa-folder-open faa-tada"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><i class="fa-fw fas fa-link faa-tada"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-heartbeat faa-tada"></i><span> 我的</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="fa-fw fas fa-music faa-tada"></i><span> 音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Gallery/"><i class="fa-fw fas fa-images faa-tada"></i><span> 照片</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/movies/"><i class="fa-fw fas fa-video faa-tada"></i><span> 电影</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="fa-fw fas fa-laptop faa-tada"></i><span> 我的装备</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw fas fa-heart faa-tada"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover" href="javascript:void(0);"><i class="fa-fw fas fa-language faa-tada"></i><span> 语言</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/"><i class="fa-fw fas fa-c faa-tada"></i><span> 中文</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/jp/"><i class="fa-fw fas fa-j faa-tada"></i><span> 日本語</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://butterfly.js.org/en/"><i class="fa-fw fas fa-e faa-tada"></i><span> English</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:23px;width:23px;fill:currentColor;position:relative;top:4px" aria-hidden="true"><use xlink:href="#icon-icon-sousuo"></use></svg></a></div><a class="meihua faa-parent animated-hover" onclick="toRandomPost()" title="随机跳转一篇文章" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-feijix"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="ライトモード/ダークモード切り替え" id="nightmode-button"><svg class="faa-tada" style="height:24px;width:24px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">双招项目后端api全过程实现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">作成日</span><time class="post-meta-date-created" datetime="2024-12-29T10:15:00.000Z" title="作成日 2024-12-29 10:15:00">2024-12-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新日</span><time class="post-meta-date-updated" datetime="2025-07-22T10:21:09.000Z" title="更新日 2025-07-22 10:21:09">2025-07-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">総文字数:</span><span class="word-count">1.8w</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">読む時間:</span><span>65分</span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><link rel="stylesheet" href="/hexo-ai-summaries/gemini.css">
<div class="post-gemini-ai">
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="126" height="20" role="img" class="ai-summary-trigger">
    <style>
      .ai-summary-active .ai-summary-icon-title text:first-of-type {
        display: none !important;
      }

      .ai-summary-active .ai-summary-icon-title text:last-child {
        display: initial !important;
      }

      .ai-summary-active #r rect {
        width: 105px !important;
      }

      .ai-summary-active .ai-summary-rect {
        width: 80px !important;
      }

      .ai-summary-pen {
        opacity: 1;
        animation: ai-wink 2s infinite;
      }

      @keyframes ai-wink {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
    <linearGradient id="s" x2="0" y2="100%">
      <stop offset="0" stop-color="#bbb" stop-opacity=".1" />
      <stop offset="1" stop-opacity=".1" />
    </linearGradient>
    <clipPath id="r">
      <rect width="125" height="20" rx="3" fill="#fff" />
    </clipPath>
    <g clip-path="url(#r)">
      <rect width="25" height="20" fill="#555" />
      <rect class="ai-summary-rect" x="25" width="100" height="20" fill="#007ec6" />
      <rect width="25" height="20" fill="url(#s)" />
    </g>
    <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110" class="ai-summary-icon-title">
      <image class="ai-summary-pen" x="5" y="3" width="14" height="14" xlink:href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9IjIiIGQ9Im0yMS42NCAzLjY0bC0xLjI4LTEuMjhhMS4yMSAxLjIxIDAgMCAwLTEuNzIgMEwyLjM2IDE4LjY0YTEuMjEgMS4yMSAwIDAgMCAwIDEuNzJsMS4yOCAxLjI4YTEuMiAxLjIgMCAwIDAgMS43MiAwTDIxLjY0IDUuMzZhMS4yIDEuMiAwIDAgMCAwLTEuNzJNMTQgN2wzIDNNNSA2djRtMTQgNHY0TTEwIDJ2Mk03IDhIM20xOCA4aC00TTExIDNIOSIvPjwvc3ZnPg==" />
      <text x="750" y="140" transform="scale(.1)" fill="#fff" textLength="900">ai-要約を取得</text>
      <text style="display: none" x="650" y="140" transform="scale(.1)" fill="#fff" textLength="600">文章摘要</text>
    </g>
  </svg>
</div>
<script src="/hexo-ai-summaries/gemini.js"></script>
<div class="note blue no-icon flat"><p>双招项目后端api全过程实现系列</p>
<ol>
<li>双招项目后端api全过程实现（一）- 登录&amp;任务模块  ⇦当前位置🪂</li>
<li><a href="/posts/1432cf2a">双招项目后端api全过程实现（二）- 合约模块</a> </li>
<li>双招项目后端api全过程实现（三）- 消息模块</li>
<li>双招项目后端api全过程实现（四）- 我的个人中心模块</li>
</ol>
</div>
<h2 id="1-初始化"><a href="#1-初始化" class="headerlink" title="1.初始化"></a>1.初始化</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <p><strong>1.1创建项目：</strong></p><ol><li><p>新建 <code>api_server</code> 文件夹作为项目根目录，并在项目根目录中运行如下的命令，初始化包管理配置文件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure></li><li><p>运行如下的命令，安装特定版本的 <code>express</code>：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm i express@4.17.1</span><br></pre></td></tr></table></figure></li><li><p>在项目根目录中新建 <code>app.js</code> 作为整个项目的入口文件，并初始化如下的代码：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express 模块</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 的服务器实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// write your code here...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3007</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;api server running at http://127.0.0.1:3007&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p><strong>1.2配置 cors 跨域&amp;解析表单数据的中间件：</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"># <span class="number">1.2</span><span class="number">.1</span>.首先安装</span><br><span class="line">pnpm i cors@<span class="number">2.8</span><span class="number">.5</span></span><br><span class="line"></span><br><span class="line">然后在 app.<span class="property">js</span> 中配置</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"># <span class="number">1.2</span><span class="number">.2</span>.配置 cors 跨域中间件</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br><span class="line"></span><br><span class="line"># <span class="number">1.2</span><span class="number">.3</span>.配置解析表单数据的中间件，仅能解析 application/x-www-form-urlencoded 类型的表单数据</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入并使用用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3007</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器启动成功: http://127.0.0.1:3007&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>1.3 初始化路由文件&amp;文件夹：</strong></p><ol><li><p>在项目根目录中，新建 <code>router</code> 文件夹，用来存放所有的<code>路由</code>模块</p><blockquote><p>路由模块中，只存放客户端的请求与处理函数之间的映射关系</p></blockquote></li><li><p>在项目根目录中，新建 <code>router_handler</code> 文件夹，用来存放所有的 <code>路由处理函数模块</code></p><blockquote><p>路由处理函数模块中，专门负责存放每个路由对应的处理函数</p></blockquote></li></ol><p><strong>1.4初始化路由模块：</strong></p><ol><li><p>在 <code>router</code> 文件夹中，新建 <code>user.js</code> 文件，作为用户的路由模块，并初始化代码如下：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入处理函数</span></span><br><span class="line"><span class="keyword">const</span> userHandler = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login/code&#x27;</span>, userHandler.<span class="property">regUser</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>,userHandler.<span class="property">login</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>初始化路由处理函数：<code>/api_server/router_handler/user.js</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册用户的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">regUser</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;reguser OK&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">login</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">&#x27;login OK&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>在 <code>app.js</code> 中，导入并使用 <code>用户路由模块</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入并注册用户路由模块</span></span><br><span class="line"><span class="keyword">const</span> userRouter = <span class="built_in">require</span>(<span class="string">&#x27;./router/user&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, userRouter)</span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<h2 id="2-创建-mysql-数据库"><a href="#2-创建-mysql-数据库" class="headerlink" title="2.创建 mysql 数据库"></a>2.创建 mysql 数据库</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <p>2.1 新建数据库&amp;表</p><p>在 MySQL Shell 中，你已经启动了交互式 Shell，所以不需要再次输入 <code>mysqlsh</code>进行启动。</p><p>下面是正确的步骤来连接到数据库：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">\sql</span><br><span class="line"></span><br><span class="line">// 端口号默认即为：3006</span><br><span class="line">\connect root@localhost</span><br><span class="line"></span><br><span class="line">// 输入密码后，即可以连接到数据库</span><br><span class="line"></span><br><span class="line">// 然后执行下面一行代码，创建数据库表</span><br><span class="line">CREATE DATABASE shuangzhao_iooio CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line">其中：CHARACTER SET utf8mb4：指定数据库的字符集为 utf8mb4，支持完整的 Unicode，包括表情符号。</span><br><span class="line">COLLATE utf8mb4_general_ci：设置排序规则为不区分大小写的通用规则。</span><br><span class="line"></span><br><span class="line">// 然后设置默认数据库</span><br><span class="line">USE shuangzhao_iooio</span><br></pre></td></tr></table></figure><p>然后，根据项目要求创建数据库表；</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建用户信息表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">    accounts <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户账号（手机号）&#x27;</span>,</span><br><span class="line">    user_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    sex TINYINT <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别（1: 男, 2: 女, 0: 未知）&#x27;</span>,</span><br><span class="line">    birthday <span class="type">DATE</span> COMMENT <span class="string">&#x27;出生日期&#x27;</span>,</span><br><span class="line">    pay_password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;支付密码（加密存储）&#x27;</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">    work_time <span class="type">DATE</span> COMMENT <span class="string">&#x27;参加工作时间&#x27;</span>,</span><br><span class="line">    head_img <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;头像URL&#x27;</span>,</span><br><span class="line">    idcard <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;身份证号码&#x27;</span>,</span><br><span class="line">    account_price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;账户余额&#x27;</span>,</span><br><span class="line">    is_check TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;审核状态（0: 未审核, 1: 已审核）&#x27;</span>,</span><br><span class="line">    it_enterprise TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否为IT企业（1: 是, 0: 否）&#x27;</span>,</span><br><span class="line">    enterprise TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否为企业用户（1: 是, 0: 否）&#x27;</span>,</span><br><span class="line">    manage TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;是否为管理员（1: 是, 0: 否）&#x27;</span>,</span><br><span class="line">    token <span class="type">VARCHAR</span>(<span class="number">512</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;登录Token&#x27;</span>,</span><br><span class="line">    expire_time <span class="type">BIGINT</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;Token过期时间（时间戳）&#x27;</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;用户信息表&#x27;</span>;</span><br></pre></td></tr></table></figure><ul><li>以上代码根据原始项目数据格式，由 chatgpt 快速生成，实际开发中需要做少许调整，例如增加 code 验证码，以及过期时间</li></ul><p>实际开发中，根据项目需求，需要对表结构进行修改，以下是增加 column 的方法示例</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tasklist </span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> head_img <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户头像链接地址&#x27;</span>;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h2 id="3-为项目后端项目安装-mysql2-模块"><a href="#3-为项目后端项目安装-mysql2-模块" class="headerlink" title="3.为项目后端项目安装 mysql2 模块"></a>3.为项目后端项目安装 mysql2 模块</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>执行以下命令，安装 mysql</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm i mysql2</span><br></pre></td></tr></table></figure></li><li><p>在项目根目录中新建 <code>/db/index.js</code> 文件，在此自定义模块中创建数据库的连接对象：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 mysql 模块</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2/promise&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建数据库连接对象</span></span><br><span class="line"><span class="keyword">const</span> db = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;admin123&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;shuangzhao_iooio&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向外共享 db 数据库连接对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = db</span><br></pre></td></tr></table></figure></li><li><p>这里需要特别注意，将来在查询数据库时，返回的结果较之前 mysql 有重大改变：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mysql 响应结果</span></span><br><span class="line">[</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">accounts</span>: <span class="string">&#x27;abc123&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>, <span class="attr">accounts</span>: <span class="string">&#x27;xyz456&#x27;</span> &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// mysql2 响应结果</span></span><br><span class="line">[</span><br><span class="line">    <span class="comment">// 查询结果：</span></span><br><span class="line">  [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">accounts</span>: <span class="string">&#x27;abc123&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;Bob&#x27;</span>, <span class="attr">accounts</span>: <span class="string">&#x27;xyz456&#x27;</span> &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询字段元数据：</span></span><br><span class="line">  [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;id&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;int&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;varchar&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;accounts&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;varchar&#x27;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 由此可以看出，想像 mysql 那时直接使用查询数据库返回的数据，那是不可能滴</span></span><br><span class="line"><span class="comment">// 在 mysql2 中，需要使用 const [results] = await db.query(sql, [id])  进行解构</span></span><br><span class="line"><span class="comment">//进而，拿到返回数组中的第一个响应结果，即查询结果</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<h2 id="4-登录模块"><a href="#4-登录模块" class="headerlink" title="4.登录模块"></a>4.登录模块</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <p>1.发送验证码&amp;登录逻辑</p><p>路由处理函数：<code>/api_server/router_handler/user.js</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在这里定义和用户相关的路由处理函数，供 /router/user.js 模块进行调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 bcryptjs 加密模块</span></span><br><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&#x27;bcryptjs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入生成 Token 的方法</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成随机验证码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">100000</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">900000</span>).<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">regUser</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 获取客户端提交的数据</span></span><br><span class="line">  <span class="keyword">const</span> userInfo = req.<span class="property">body</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// if (!userInfo.accounts) &#123;</span></span><br><span class="line">  <span class="comment">//   // return res.send(&#123; status: 1, message: &#x27;手机号码不能为空！&#x27; &#125;);</span></span><br><span class="line">  <span class="comment">//   return res.cc(&#x27;手机号不能为空&#x27;,1)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> code = <span class="title function_">generateCode</span>() <span class="comment">// 生成 6 位随机验证码</span></span><br><span class="line">  <span class="keyword">const</span> codeExpiresAt = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>) <span class="comment">// 验证码有效期 5 分钟</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> codeBcrypt = bcrypt.<span class="title function_">hashSync</span>(code, <span class="number">10</span>) <span class="comment">// 对验证码进行加密处理</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询是否存在相同手机号码的用户</span></span><br><span class="line">  <span class="keyword">const</span> sqlStr = <span class="string">&#x27;SELECT * FROM users WHERE accounts = ?&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> rows = <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlStr, userInfo.<span class="property">accounts</span>) <span class="comment">// 参数数组必须使用 [], 只有一个参数时可以省略</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询语句得到的是一个数组，如果数组长度大于 0，说明用户已存在</span></span><br><span class="line">  <span class="keyword">if</span> (rows.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果用户已存在，更新验证码和过期时间</span></span><br><span class="line">    <span class="keyword">const</span> updateSql = <span class="string">&#x27;UPDATE users SET code = ?, code_expires_at = ? WHERE accounts = ?&#x27;</span></span><br><span class="line">    <span class="keyword">await</span> db.<span class="title function_">query</span>(updateSql, [codeBcrypt, codeExpiresAt, userInfo.<span class="property">accounts</span>])</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果用户不存在，插入新用户记录</span></span><br><span class="line">    <span class="keyword">const</span> insertSql = <span class="string">&#x27;INSERT INTO users (accounts, code, code_expires_at) VALUES (?, ?, ?)&#x27;</span></span><br><span class="line">    <span class="keyword">await</span> db.<span class="title function_">query</span>(insertSql, [userInfo.<span class="property">accounts</span>, codeBcrypt, codeExpiresAt])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回验证码（开发阶段用，生产环境中不要返回验证码）</span></span><br><span class="line">  res.<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="string">&#x27;验证码已生成&#x27;</span>,</span><br><span class="line">    <span class="attr">result</span>: &#123;</span><br><span class="line">      <span class="attr">code</span>: code</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// res.status(500).send(&#123; status: 1, message: &#x27;服务器内部错误&#x27; &#125;);</span></span><br><span class="line">  res.<span class="title function_">cc</span>(error,<span class="number">500</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录的处理函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userInfo = req.<span class="property">body</span> <span class="comment">// 获取用户提交的数据</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userInfo:&#x27;</span>, userInfo)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 验证输入</span></span><br><span class="line">    <span class="keyword">if</span> (!userInfo.<span class="property">code</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&quot;验证码不能为空！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 查询用户信息</span></span><br><span class="line">    <span class="keyword">const</span> sqlStr = <span class="string">&quot;SELECT * FROM users WHERE accounts = ?&quot;</span></span><br><span class="line">    <span class="keyword">const</span> [results] = <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlStr, [userInfo.<span class="property">accounts</span>]) <span class="comment">// 确保 `db.query` 返回一个 Promise</span></span><br><span class="line">    <span class="keyword">if</span> (results.<span class="property">length</span> !== <span class="number">1</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&quot;没有查到用户信息！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> user = results[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 检查验证码是否正确</span></span><br><span class="line">    <span class="keyword">const</span> compareResult = bcrypt.<span class="title function_">compareSync</span>(userInfo.<span class="property">code</span>, user.<span class="property">code</span>)</span><br><span class="line">    <span class="keyword">if</span> (!compareResult) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&quot;验证码错误！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 检查验证码是否过期</span></span><br><span class="line">    <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">if</span> (now &gt; user.<span class="property">code_expires_at</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&quot;验证码已过期，请重新获取！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成 Token 字符串</span></span><br><span class="line">    user = &#123;...results[<span class="number">0</span>], <span class="attr">code</span>: <span class="string">&#x27;你猜&#x27;</span>, <span class="attr">code_expires_at</span>: <span class="string">&#x27;你猜&#x27;</span>, <span class="attr">head_img</span>: <span class="string">&#x27;你猜&#x27;</span>&#125;</span><br><span class="line">    <span class="comment">// 对信息加密</span></span><br><span class="line">    <span class="keyword">const</span> tokenStr = jwt.<span class="title function_">sign</span>(user, config.<span class="property">jwtSecretKey</span>, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;30d&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 登录成功</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">      <span class="attr">result</span>: &#123;</span><br><span class="line">        <span class="attr">errCode</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&quot;登录成功&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">user_info</span>: &#123;</span><br><span class="line">            <span class="attr">accounts</span>: user.<span class="property">accounts</span>,</span><br><span class="line">            <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">user_name</span>: user.<span class="property">user_name</span>,</span><br><span class="line">            <span class="attr">sex</span>: user.<span class="property">sex</span>,</span><br><span class="line">            <span class="attr">birthday</span>: user.<span class="property">birthday</span>,</span><br><span class="line">            <span class="attr">pay_password</span>: user.<span class="property">pay_password</span>,</span><br><span class="line">            <span class="attr">email</span>: user.<span class="property">email</span>,</span><br><span class="line">            <span class="attr">work_time</span>: user.<span class="property">work_time</span>,</span><br><span class="line">            <span class="attr">head_img</span>: user.<span class="property">head_img</span>,</span><br><span class="line">            <span class="attr">idcard</span>: user.<span class="property">idcard</span>,</span><br><span class="line">            <span class="attr">account_price</span>: user.<span class="property">account_price</span>,</span><br><span class="line">            <span class="attr">is_check</span>: user.<span class="property">is_check</span>,</span><br><span class="line">            <span class="attr">it_enterprise</span>: user.<span class="property">it_enterprise</span>,</span><br><span class="line">            <span class="attr">enterprise</span>: user.<span class="property">enterprise</span>,</span><br><span class="line">            <span class="attr">manage</span>: user.<span class="property">manage</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">token</span>: <span class="string">&quot;Bearer &quot;</span> + tokenStr,</span><br><span class="line">          <span class="attr">expireTime</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">7</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span> <span class="comment">// 7 天后的时间戳</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 捕获异常</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">    res.<span class="title function_">cc</span>(<span class="string">&quot;服务器内部错误！&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; regUser, login &#125;</span><br></pre></td></tr></table></figure><p>2.登录验证</p><p>3.阅读协议</p><ol><li>首先，创建数据库表</li></ol><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> protocols (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    content TEXT,</span><br><span class="line">    isdelete TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    sort <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    type <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> protocols (title, content, isdelete, sort, type)</span><br><span class="line"><span class="keyword">VALUES</span> </span><br><span class="line">(<span class="string">&#x27;《用户协议》&#x27;</span>, <span class="string">&#x27;尊敬的用户：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">在您成为IT企业服务注册用户，使用IT企业服务提供的服务之前，请您认真阅读IT企业服务《用户协议》（以下简称“协议”），更好地了解我们所提供的服务以及您享有的权利和承担的义务。您一旦开始使用IT企业服务服务，即表示您已经确认并接受了本文件中的全部条款。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">本协议系由您（以下简称“用户”或“您”）与北京北京驻场无忧科技有限公司（以下简称“IT企业服务”或“我们”）就IT企业服务公司提供的IT企业服务软件（以下简称“本平台”或“IT企业服务”）所订立的相关权利义务规范。请您在注册、使用IT企业服务之前，认真阅读以下条款。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">（温馨提示：为了您的合法权益不受损害，平台建议您在使用IT企业服务找工作前，仔细阅读《安全求职指南》，谨防各类求职陷阱。）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">一、注册条款的接受</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">一旦您在注册页面点击或勾选“阅读并同意接受用户协议及隐私政策”相关内容后，即表示您已经阅读并且同意与IT企业服务公司达成协议，成为IT企业服务的用户，并接受本协议中的全部注册条款以及IT企业服务《隐私政策》和本平台内公布的其他专项协议或规则，包括但不限于IT企业服务《职位信息发布规则》《IT企业服务增值服务协议》（以下简称“本平台规则”）的所有条款的约束。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">二、用户注册条件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 申请注册成为IT企业服务的用户应同时满足下列全部条件：在注册之日以及此后使用IT企业服务服务期间必须以招聘和/或求职为目的；在注册之日必须年满16周岁以上。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 为了更好地享有IT企业服务网络信息发布平台服务，用户应遵守IT企业服务注册机制的要求，向IT企业服务提供本人真实、准确、最新及完整的资料；如注册并认证成为招聘用户，应保证及时更新本人提供的“单位名称、职务或岗位信息、企业邮箱”等相关授权信息及材料，并确保前述授权的真实性；用户应保证其职务行为，包括但不限于发布招聘信息、与求职者沟通等均在使用本平台期间持续有效；通过认证的用户应保持其招聘账号与对应的授权单位具有唯一性。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 若用户提供任何错误、不实或不完整的资料，或IT企业服务有理由怀疑资料为错误、不实或不完整及违反用户注册条款的，或IT企业服务有理由怀疑其用户资料、言行等有悖于“严肃纯净的招聘APP”主题或违反《IT企业服务职位信息发布规则》的，IT企业服务有权修改用户的注册昵称、个人说明、发布的信息等，或暂停或终止该用户使用其账号，或暂停或终止提供IT企业服务提供的全部或部分服务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 若用户故意提供虚假的身份信息、公司信息进行注册，发布虚假招聘信息或者求职信息的，视为严重违反本协议，IT企业服务有权暂停或终止该用户账号并停止提供服务。虚假注册、发布虚假信息给IT企业服务造成经济、名誉等任何损失的，IT企业服务将追究该用户的法律责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">三、用户账号安全</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户的账号遭到未获授权的使用，或者发生其他任何安全问题时，用户应立即通知IT企业服务。由于用户使用不当或者其他非因IT企业服务导致的账号、密码泄漏，进而导致其资料、信息泄漏的，由用户承担其不利后果。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. IT企业服务账号的所有权归IT企业服务公司所有，用户完成账号注册程序后，获得IT企业服务账号的使用权，且该使用权仅属于账号初始注册人。同时，用户不得赠与、借用、租用、转让或售卖IT企业服务账号或者以其他方式许可他人使用IT企业服务账号。其他人不得通过受赠、继承、承租、受让或者其他任何方式使用IT企业服务账号。如果我们发现或者有合理理由认为账号使用者并非账号初始注册人，为保障账号安全，我们有权立即暂停或终止向该注册账号提供服务，并有权永久禁用该账号。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 用户不得将账号主动告知第三方或提供给第三方进行使用，例如提供给第三方进行代为购买IT企业服务服务等。如因此造成其他用户隐私泄露或经济损失以及本平台损失的，用户应当承担全部责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">四、服务说明</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 基于风控策略/安全风险/产品政策等的需要，IT企业服务可能要求部分用户补充提供材料（包括但不限于企业资质证明、承诺书、业务协议等），具体要求会在相关页面上做明确展示。如用户拒绝提供前述材料，IT企业服务有权视情况暂停或终止向该用户提供部分或全部服务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 为落实《网络招聘服务管理规定》的核验更新义务，IT企业服务可能会不定期对部分用户的企业地址、招聘授权等相关信息进行真实性审查以及更新核验(目前，该审核机制包括“环境认证”和“线下审核”)。审查过程中，用户应配合 IT企业服务工作人员补充相关资料(包括但不限于营业执照、资质证书/相关业务协议、授权书、被授权人身份证信息、租赁协议/水电费记录等)，并允许 IT企业服务工作人员对其企业 LOGO、办公环境进行审查及拍照备案(具体要求见网页说明或“小秘书”通知)。若用户拒绝，IT企业服务将视情况决定是否恢复该用户使用账号，或者暂停或终止为该用户提供部分或全部的招聘、求职服务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 对于利用IT企业服务进行非法活动，或其言行（无论线上或者线下的）背离IT企业服务严肃招聘目的的，IT企业服务将严肃处理，包括将其列入黑名单、将其被投诉的情形公之于众、删除用户账号等处罚措施，给IT企业服务造成经济或者名誉等任何损失的，IT企业服务将追究其法律责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. IT企业服务有权通过拨打电话、发送短信或电子邮件等方式，告知用户IT企业服务服务相关的广告信息、促销等营销信息，以及邀请用户参与版本测试、用户体验反馈、回访等活动。除系统通知或重要信息外，用户可以通过IT企业服务提供的方式选择不接收上述信息。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. 为提高IT企业服务用户求职招聘的成功率和效率，IT企业服务公司可能会将IT企业服务用户的信息公开展示范围扩大至我们的第三方合作平台，因此，您在使用IT企业服务时，可能还会收到来自IT企业服务合作的其他平台上的注册用户向您开聊、联系电话、视频面试邀请等相关信息。在此期间，您可通过IT企业服务《隐私政策》了解我们如何保障您的个人信息的安全。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. 用户应通过本平台使用相关服务，未经许可，不得通过其他第三方工具或运营平台获取IT企业服务服务，包括但不限于通过第三方软件登录IT企业服务账号、发布职位、浏览职位、收发简历等。如因用户使用第三方软件导致相关信息泄漏的，IT企业服务不承担任何责任，且用户还应承担由此给IT企业服务造成的损失。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">五、有限责任条款</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. IT企业服务公司将尽力为用户提供提供安全、及时、准确、高质量的服务，但不保证一定能满足用户的要求和期望，也不保证服务不会中断，对服务的及时性、安全性、准确性都不作保证。除非另有约定，否则用户因无法使用IT企业服务服务，或使用服务未达到心理预期的，IT企业服务不承担责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 对于用户通过IT企业服务公司提供的服务传送的内容，IT企业服务会尽合理努力按照国家有关规定严格审查，但无法完全控制经由软件/网站服务传送的内容，不保证内容的正确性、完整性或品质。因此用户在使用IT企业服务服务时，可能会接触到令人不快、不适当或令人厌恶的内容。在任何情况下，IT企业服务均不为用户经由软件/网站服务以张贴、发送电子邮件或其它方式传送的任何内容负责。但IT企业服务有权依法停止传输任何前述内容并采取相应行动，包括但不限于暂停用户使用软件/网站服务的全部或部分，保存有关记录，并根据国家法律法规、相关政策在必要时向有关机关报告并配合有关机关的行动。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 对于IT企业服务提供的各种第三方广告信息、链接、资讯等（如有），IT企业服务不保证其内容的正确性、合法性或可靠性，相关责任由广告主承担；并且，对于用户经由IT企业服务服务与广告主进行联系或商业往来，完全属于用户和广告主之间的行为，与IT企业服务无关。对于前述商业往来所产生的任何损害或损失，IT企业服务不承担任何责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 对于用户上传的照片、资料、证件、视频、内容及图片等，IT企业服务已采用相关措施并已尽合理努力进行审核，但不保证其内容的正确性、合法性或可靠性，相关责任由上传上述内容的用户承担。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. 用户应对IT企业服务上的其他用户发布的内容自行加以判断，并承担因使用内容而引起的所有风险，包括但不限于因对内容的正确性、完整性或实用性的依赖而产生的风险。IT企业服务公司无法且不会对因前述风险而导致的任何损失或损害承担责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. 是否使用软件/网站服务下载或取得任何资料应由用户自行考虑并自负风险，因任何资料的下载而导致的用户电脑系统的任何损坏或数据丢失等后果，IT企业服务不承担任何责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7. 对于IT企业服务公司在线上或线下策划、发起、组织或是承办的任何招聘相关的活动（包括但不限于收取费用以及完全公益的活动），IT企业服务不对上述招聘效果向用户作出任何保证或承诺，也不担保活动期间用户自身行为的合法性、合理性。由此产生的任何对于用户个人或者他人的人身或者是名誉以及其他损害，应由行为实施主体承担责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8. 对于用户的投诉，IT企业服务将尽合理努力进行核实和处理，但不保证一定能满足投诉者的要求。IT企业服务有权决定是否向公众或向被投诉者公开投诉内容。对于投诉内容侵犯用户隐私权、名誉权等合法权益的，所有法律责任由投诉者承担，与IT企业服务无关。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">六、用户权利</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     用户对于自己的个人信息享有以下权利：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 随时查询及请求阅览，但因极少数特殊情况（如被网站加入黑名单等）无法查询及提供阅览的除外；</span></span><br><span class="line"><span class="string">1. 随时查询及请求阅览，但因极少数特殊情况（如被网站加入黑名单等）无法查询及提供阅览的除外；</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 随时请求补充或更正，但因极少数特殊情况（如网站或有关机关为司法程序保全证据等）无法补充或更正的除外；</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">七、用户应承诺其平台使用行为遵守以下规定</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 本协议所称“平台使用”是指用户使用本平台服务所进行的任何行为，包括但不限于注册、登录、认证、查看开聊、账号管理、发布招聘信息、邀约面试以及其他通过IT企业服务账号在本平台所进行的一切行为。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. IT企业服务公司提醒用户在使用IT企业服务服务时，应遵守《中华人民共和国民法典》《中华人民共和国著作权法》《全国人民代表大会常务委员会关于维护互联网安全的决定》《中华人民共和国保守国家秘密法》《中华人民共和国电信条例》《中华人民共和国计算机信息系统安全保护条例》《中华人民共和国计算机信息网络国际联网管理暂行规定》《计算机信息系统国际联网保密管理规定》《互联网信息服务管理办法》《计算机信息网络国际联网安全保护管理办法》《互联网电子公告服务管理规定》《网络安全法》《中华人民共和国劳动法》《中华人民共和国劳动合同法》《网络信息内容生态治理规定》等相关中国法律法规的规定。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 在任何情况下，如果IT企业服务公司有理由认为用户使用IT企业服务服务过程中的任何行为，包括但不限于用户的任何言论和其它行为违反或可能违反上述法律和法规的任何规定，IT企业服务公司可在任何时候不经任何事先通知终止向该用户提供服务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 用户承诺在使用IT企业服务期间，遵守法律法规、社会主义制度、国家利益、公民合法权益、公共秩序、社会道德风尚和信息真实性等七条底线。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. 您理解并同意，本平台仅为用户提供招聘信息分享、传播及获取招聘、求职机会的平台，您必须为自己的注册、认证账号下的一切行为负责，包括您所发表的任何内容以及由此产生的任何后果。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. 用户使用本平台服务进行招聘或求职的，还应遵守IT企业服务《职位信息发布规则》。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">八、禁止用户利用IT企业服务从事下列行为</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">禁止用户在IT企业服务平台或利用IT企业服务提供的服务，制作、发送、复制、发布、传播违反国家相关法律法规、七条底线、九不准管理规定、本平台规则的信息、从事违反前述规定/规则的活动，主要表现为：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 反对宪法所确定的基本原则的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 损害国家荣誉和利益的；煽动民族仇恨、民族歧视、破坏民族团结的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 破坏国家宗教政策，宣扬邪教和封建迷信的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. 散布谣言，扰乱社会秩序，破坏社会稳定的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. 散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7. 侮辱或者诽谤他人，侵害他人合法权益的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8. 含有虚假、有害、胁迫、侵害他人隐私、骚扰、侵害、中伤、粗俗、猥亵、或有悖道德、令人反感的内容的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">9. 含有中国法律、法规、规章、条例以及任何具有法律效力的规范所限制或禁止的其他内容的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">10. 使用IT企业服务服务的过程中，以任何方式危害求职者合法权益的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">11. 冒充任何人或机构，包含但不限于冒充IT企业服务工作人员或以虚伪不实的方式陈述或谎称与任何人或机构有关的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12. 发布、传播侵犯任何人的肖像权、名誉权、隐私权、专利权、商标权、著作权、商业秘密的信息或言论的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">13. 将病毒或其它计算机代码、档案和程序，加以上载、张贴、发送电子邮件或以其它方式传送的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">14. 跟踪或以其它方式骚扰其他用户的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">15. 未经合法授权而截获、篡改、收集、储存或删除他人个人信息、电子邮件或其它数据资料，或将获知的此类资料用于任何非法或不正当目的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">16. 以任何方式干扰或企图干扰IT企业服务的任何产品、任何部分或功能的正常运行，或者制作、发布、传播上述工具、方法等。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17. 未能按照本平台的流程、规则进行注册、认证或使用本服务的，违反本服务功能限制或运营策略，或采取任何措施规避前述流程、规则、限制或策略的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">18. 未经IT企业服务公司的许可使用插件、外挂或通过其他第三方工具、运营平台或任何服务接入本服务和相关系统的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">19. 利用IT企业服务账号或本平台服务从事，包括但不限于欺诈、传销、刷流量、好评、违法物品营销等任何违法兼职或犯罪活动的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">20. 仿冒、混淆他人账号昵称、头像、功能介绍或发布招聘内容等，或冒充、利用他人名义对外招聘的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">21. 未经IT企业服务公司的许可，以任何目的自行或授权、允许、协助任何第三人对平台内的任何信息内容进行非法获取，用于商业用途或其他任何目的。“非法获取”是指采用包括但不限于“”(spider)程序、爬虫程序、拟人程序等非真实用户或避开、破坏技术措施等非正常浏览的手段、方式，读取、复制、转存、获得数据和信息内容的行为。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">22. 为任何注册用户或非注册用户提供自动登录到本平台、代办或协助他人代办身份认证服务的或代售身份认证所需的相关材料或凭据等。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">23. 任何导致或可能导致IT企业服务公司与第三方产生纠纷、争议或诉讼的行为。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">九、特别规定</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户如违反本协议第八条，IT企业服务有权在任何时候不经任何事先通知暂停或终止向该用户提供服务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 用户有下列行为或发布/散布/传播如下相关信息的，IT企业服务在发现或接到投诉后，有权采取冻结账号、升级认证或以其他方式暂停向该用户提供服务，并要求用户承担相应的损害赔偿责任：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    （1）涉及广告（寻求合作）、传销或直销等内容</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （2）涉及色情、淫秽内容</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （3）涉及违法/政治敏感内容</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （4）虚假信息，包括但不限于不真实的公司信息、薪资、身份、个人简历、职位信息等</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （5）利用IT企业服务提供的服务索取他人隐私</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （6）涉及人身攻击或其他侵害他人权益的内容</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （7）未成年人工作信息</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （8）招聘他人从事违法活动</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （9）以培训费、服装费等名义骗取求职者财物</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （10）骚扰其他用户</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （11）不符合IT企业服务相关服务性质的信息，如鸡汤、段子、水贴等</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （12）利用本平台可能存在的漏洞恶意充值直豆、获取道具等虚拟产品或服务</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （13）在本平台以外的任何第三方平台（包括但不限于淘宝、闲鱼等）售卖道具等虚拟产品或服务的行为</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （14）通过第三方平台或渠道（如淘宝店铺等）购买道具等虚拟产品或服务</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （15）涉嫌拖欠/未按法律规定支付薪资/劳务报酬的，或涉嫌具有其他可能损害劳动者或劳务人员合法权益的。（涉及农民工或涉众的均属于“情节严重”）本平台有权对前述情形进行处置，相关判断方式包括但不限于因上述行为被列入相关政府部门“黑名单”、被多名用户举报投诉或被新闻媒体曝光等情形</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （16）两位用户名下认证的账号，经系统判定为关联账号的，如其中一个账号因违法违规被冻结的，其他关联账号均将被同时冻结。</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    （17）其他违反法律法规或国家政策以及损害IT企业服务及其合法用户之合法权益的行为</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3.       根据我国现行的法律法规等相关规定，如用户实施前述第（4）项“发布虚假信息”的，包括但不限于用户发布的职位信息与其实际招聘的职位不符的，如用户实际招聘的职位为“保险销售、信用卡销售、理财产品销售、地产中介或销售或劳务派遣”，与其发布的职位信息在内容、类型或其他方面并非一致或对应的甚至不存在，IT企业服务公司随时有权拒绝向该用户提供服务，并可采取其他处理措施，包括但不限于“永久性封禁账号”、“永久性将其设备号、手机号等相关信息冻结”或“永久性加入名单’”等。</span></span><br><span class="line"><span class="string">3.       根据我国现行的法律法规等相关规定，如用户实施前述第（4）项“发布虚假信息”的，包括但不限于用户发布的职位信息与其实际招聘的职位不符的，如用户实际招聘的职位为“保险销售、信用卡销售、理财产品销售、地产中介或销售或劳务派遣”，与其发布的职位信息在内容、类型或其他方面并非一致或对应的甚至不存在，IT企业服务公司随时有权拒绝向该用户提供服务，并可采取其他处理措施，包括但不限于“永久性封禁账号”、“永久性将其设备号、手机号等相关信息冻结”或“永久性加入名单’”等。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十、隐私政策</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IT企业服务依法保护用户个人信息和隐私信息。有关隐私政策的内容，详见IT企业服务《隐私政策》。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十一、关于用户在IT企业服务的上传或张贴的内容</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户在IT企业服务上传或张贴的内容（包括但不限于照片、文字、面试经历及心得评价等），视为用户授予IT企业服务公司及其关联公司免费、非独家的使用权，IT企业服务有权为展示、传播及推广前述张贴内容的目的，对上述内容进行复制、修改、出版等。该使用权持续至用户书面通知IT企业服务不得继续使用，且IT企业服务实际收到该等书面通知时止。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 因用户上传或张贴的内容侵犯他人权利，而导致任何第三方向IT企业服务公司提出侵权或索赔要求的，用户应承担全部责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 任何第三方对于用户在IT企业服务的公开使用区域张贴的内容进行复制、修改、编辑、传播等行为的，该行为产生的法律后果和责任均由行为人承担，与IT企业服务无关。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十二、关于面试聊天等即时通讯服务</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户在接受IT企业服务提供与IT企业服务注册用户或IT企业服务关联方用户进行提在线开聊、邀约面试等即时通讯服务时，应当遵守法律法规、社会主义制度、国家利益、公民合法权益、公共秩序、社会道德风尚，并保证所传输的信息真实性等七条底线。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 用户通过本平台与他人在线开聊、拨打电话以及视频面试等商务场景下产生的文字、语音及视频等形式的沟通信息，IT企业服务将会根据法律规定暂时存储，且仅用于投诉举报的处理、安全风控及离线暂存功能的实现。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. IT企业服务对该信息的采集、传输及存储均会采取加密、防泄露等相关措施。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 为保护其他用户隐私，您不得下载、传播或公开发布本条规定的其他用户通讯信息，如面试聊天记录等。如因此造成IT企业服务损失，或者侵害其他用户权益的，您应当承担违约责任或赔偿责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十三、信息储存和限制</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IT企业服务有权制定一般措施及限制，包含但不限于软件服务将保留的电子邮件、聊天信息、所张贴内容或其他上载内容的最长期间、每个账号可收发沟通讯息的最大数量及可收发的单个消息的大小。通过服务存储或传送之任何信息、通讯资料和其他内容，如被删除或未予储存，IT企业服务不承担任何责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十四、结束服务</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">用户若反对任何注册条款的内容或对之后注册条款修改有异议，或对IT企业服务服务不满，用户有以下权利：不再使用IT企业服务服务；结束用户使用IT企业服务服务的资格；通知IT企业服务停止该用户的服务。结束用户服务的同时，用户使用IT企业服务服务的权利立即终止，IT企业服务不再对用户承担任何义务。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十五、禁止商业行为</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户同意不对IT企业服务提供的服务或服务的任何部分，进行复制、拷贝、出售、转售或用于任何其他商业目的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 禁止通过职位向应聘者收费，如有不实，我们将结束用户使用IT企业服务服务的资格。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十六、违约责任</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 用户使用虚假身份信息、公司信息进行注册，发布虚假招聘、求职信息，发布含有传销、色情、反动等严重违法内容，对外传播面试聊天等通讯记录等行为，视为严重违反本协议，应当承担给IT企业服务公司造成的经济损失和名誉损失。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 因用户通过IT企业服务提供的服务提供、张贴或传送内容、违反本服务条款、或侵害他人任何合法权益而导致任何第三人对IT企业服务提出任何索赔或请求，用户应当赔偿IT企业服务或其他合作伙伴的损失，包括但不限于赔偿金额、律师费和合理的调查费用等。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 用户在投诉其他用户有违法行为或违反本注册条款情形时，投诉者应承担不实投诉所产生的全部法律责任。如侵犯他人的合法权益，投诉人应独立承担全部法律责任。如给IT企业服务造成损失的，投诉人应对IT企业服务承担相应的赔偿责任。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十七、本协议条款的变更和修改</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IT企业服务有权依法随时对本协议的任何条款进行变更和修改。一旦发生条款变动，我们将在IT企业服务软件内进行更新及提示，或将最新版本的《用户协议》以系统消息、弹框或邮件的形式发送给用户阅读及确认接收。用户如果不同意条款的修改，应主动停止使用IT企业服务或申请注销IT企业服务账号，如未使用的付费权益将在注销后清空。否则，如果用户继续使用用户账号，则视为用户已经接受本协议全部条款的修改。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十八、不可抗力</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. “不可抗力”是指IT企业服务不能合理控制、不可预见或即使预见亦无法避免的事件，该事件妨碍、影响或延误IT企业服务根据本注册条款履行其全部或部分义务。该事件包括但不限于政府行为、自然灾害、、黑客袭击、电脑病毒、网络故障等。不可抗力可能导致IT企业服务无法访问、访问速度缓慢、存储数据丢失、用户个人信息泄漏等不利后果。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 遭受不可抗力事件时，IT企业服务可中止履行本协议项下的义务直至不可抗力的影响消除为止，并且不因此承担违约责任；但应尽最大努力克服该事件，减轻其负面影响。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">十九、通知</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IT企业服务向其用户发出的通知，将采用系统消息、弹窗、电子邮件或页面公告等形式。本《用户协议》的条款修改或其他事项变更时，IT企业服务可以以上述形式进行通知。</span></span><br><span class="line"><span class="string">&#x27;</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h2 id="5-定义一个全局中间件-res-cc"><a href="#5-定义一个全局中间件-res-cc" class="headerlink" title="5.定义一个全局中间件 res.cc"></a>5.定义一个全局中间件 res.cc</h2><details class="folding-tag" ><summary> 定义 res.cc 用于简化错误的响应逻辑 点击查看详情 </summary>
              <div class='content'>
              <p>首先在 app.js 中定义 res.cc 这个中间件</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 响应数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">cc</span> = <span class="function">(<span class="params">err, status = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// status 默认值为 1，表示失败的情况</span></span><br><span class="line">    <span class="comment">// err 可能是一个 Error 对象，也可能时一个描述错误信息的字符串</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      status,</span><br><span class="line">      <span class="attr">message</span>: err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err.<span class="property">message</span> : err</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>然后，在 处理函数中直接使用</p>  <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">regUser</span> = <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 获取客户端提交的数据</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!userInfo.<span class="property">accounts</span>) &#123;</span><br><span class="line">      <span class="comment">// return res.send(&#123; status: 1, message: &#x27;手机号码不能为空！&#x27; &#125;);</span></span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;手机号不能为空&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> code = <span class="title function_">generateCode</span>(); <span class="comment">// 生成 6 位随机验证码</span></span><br><span class="line">    <span class="keyword">const</span> codeExpiresAt = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// 验证码有效期 5 分钟</span></span><br><span class="line"></span><br><span class="line">    codeBcrypt = bcrypt.<span class="title function_">hashSync</span>(code, <span class="number">10</span>); <span class="comment">// 对验证码进行加密处理</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询是否存在相同手机号码的用户</span></span><br><span class="line">    <span class="keyword">const</span> sqlStr = <span class="string">&#x27;SELECT * FROM users WHERE accounts = ?&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> rows = <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlStr, userInfo.<span class="property">accounts</span>); <span class="comment">// 参数数组必须使用 [], 只有一个参数时可以省略</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询语句得到的是一个数组，如果数组长度大于 0，说明用户已存在</span></span><br><span class="line">    <span class="keyword">if</span> (rows.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果用户已存在，更新验证码和过期时间</span></span><br><span class="line">      <span class="keyword">const</span> updateSql = <span class="string">&#x27;UPDATE users SET code = ?, code_expires_at = ? WHERE accounts = ?&#x27;</span>;</span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(updateSql, [codeBcrypt, codeExpiresAt, userInfo.<span class="property">accounts</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果用户不存在，插入新用户记录</span></span><br><span class="line">      <span class="keyword">const</span> insertSql = <span class="string">&#x27;INSERT INTO users (accounts, code, code_expires_at) VALUES (?, ?, ?)&#x27;</span>;</span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(insertSql, [userInfo.<span class="property">accounts</span>, codeBcrypt, codeExpiresAt]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回验证码（开发阶段用，生产环境中不要返回验证码）</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">success</span>: <span class="string">&#x27;验证码已生成&#x27;</span>,</span><br><span class="line">      <span class="attr">result</span>: &#123;</span><br><span class="line">        <span class="attr">code</span>: code,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">cc</span>(error,<span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>需要注意的是：</strong></p><p>代码已经使用了现代的 <code>async/await</code> 风格，避免了传统的回调函数。传统回调函数的用法如下：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">db.<span class="title function_">query</span>(sql, params, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="comment">// 处理错误</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理查询结果</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>而在使用 <code>Promise</code> 和 <code>async/await</code> 时，写法变成这样：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [rows] = <span class="keyword">await</span> db.<span class="title function_">query</span>(sql, params); <span class="comment">// `rows` 是查询结果</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rows);</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  res.<span class="title function_">cc</span>(error,<span class="number">500</span>) <span class="comment">// 处理错误</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回调函数的本质已经由 <code>Promise</code> 替代</p><ul><li>在你的代码中，<code>db.query()</code> 是一个 <code>Promise</code>，通过 <code>await</code> 获取它的结果。</li><li>数据库操作完成后，返回的结果（或者错误）会自动传递给 <code>await</code> 或 <code>catch</code>，不需要显式地定义回调函数。</li></ul><p>操作数据库后的回调函数已经被隐式地替代为 <code>Promise</code> 的 <code>resolve</code> 和 <code>reject</code> 方法：</p><ul><li>如果查询成功，<code>Promise</code> 的结果会被赋值给 <code>rows</code>。</li><li>如果查询失败，错误会被抛出，进入 <code>catch</code> 块。</li></ul><p>总结</p><p>在现代 JavaScript 中，推荐使用 <code>Promise</code> 和 <code>async/await</code> 进行异步操作，因为它比传统的回调函数写法更简洁、更易读。如果你正在使用的是 <code>mysql2/promise</code> 模块，你的代码中不需要显式定义回调函数。</p><p>其实，严格来说，<strong>以上代码不是一个错误处理中间件</strong>，而是一个<strong>响应辅助中间件</strong>。它的主要作用是为 <code>res</code> 对象添加一个 <code>res.cc</code> 方法，用于统一处理成功或失败的响应消息。</p><p><strong>为什么不是错误处理中间件？</strong></p><ol><li><p><strong>错误处理中间件的定义</strong><br>错误处理中间件是专门用于捕获和处理请求处理过程中发生的错误的，它的函数签名和普通中间件不同：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这才是错误处理中间件</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>错误处理中间件的第一个参数必须是 <code>err</code>，这个参数由 <code>next(error)</code> 传递过来，Express 会自动将错误传递给这样的中间件。</p><p><strong>名字不强制一致</strong>：<br><code>err</code> 是错误处理中间件中常见的约定，但你可以自由命名它。</p></li><li><p><strong>该中间件不接收 err 参数</strong><br>上面定义的 <code>res.cc</code> 是一个工具方法，用于格式化响应内容，它并没有处理通过 <code>next(error)</code> 抛出的错误。因此，<strong>这不能算作一个错误处理中间件</strong>。</p></li></ol><hr><p><strong>这个中间件的作用</strong></p><ol><li><strong>为 res 对象添加一个统一的响应方法 (res.cc)</strong><ul><li>成功的响应：<code>res.cc(&#39;操作成功&#39;, 0)</code></li><li>失败的响应：<code>res.cc(&#39;操作失败&#39;)</code> 或 <code>res.cc(new Error(&#39;错误信息&#39;))</code></li></ul></li><li><strong>简化了代码书写</strong><br>你可以通过 <code>res.cc</code> 快速发送 JSON 格式的响应，而不需要每次手动写 <code>res.send({ status, message })</code>。</li></ol>
              </div>
            </details>
<h2 id="6-全局错误中间件"><a href="#6-全局错误中间件" class="headerlink" title="6.全局错误中间件"></a>6.全局错误中间件</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <p>app.js 中，定义全局错误处理中间件</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 响应数据的中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">cc</span> = <span class="function">(<span class="params">err, status = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      status,</span><br><span class="line">      <span class="attr">message</span>: err <span class="keyword">instanceof</span> <span class="title class_">Error</span> ? err.<span class="property">message</span> : err,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局错误处理中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;捕获到错误:&#x27;</span>, err); <span class="comment">// 打印错误日志</span></span><br><span class="line">  res.<span class="title function_">cc</span>(err, <span class="number">500</span>); <span class="comment">// 使用 res.cc 统一返回错误信息</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>处理函数末尾，catch(error)</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">regUser</span> = <span class="title function_">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 获取客户端提交的数据</span></span><br><span class="line">    <span class="keyword">const</span> userInfo = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!userInfo.<span class="property">accounts</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;手机号不能为空&#x27;</span>, <span class="number">1</span>); <span class="comment">// 使用 res.cc 返回错误</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟生成验证码的逻辑</span></span><br><span class="line">    <span class="keyword">const</span> code = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> codeExpiresAt = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// 验证码 5 分钟有效期</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟数据库操作</span></span><br><span class="line">    <span class="keyword">const</span> sqlStr = <span class="string">&#x27;SELECT * FROM users WHERE accounts = ?&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> rows = <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlStr, [userInfo.<span class="property">accounts</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rows.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> updateSql = <span class="string">&#x27;UPDATE users SET code = ?, code_expires_at = ? WHERE accounts = ?&#x27;</span>;</span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(updateSql, [code, codeExpiresAt, userInfo.<span class="property">accounts</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> insertSql = <span class="string">&#x27;INSERT INTO users (accounts, code, code_expires_at) VALUES (?, ?, ?)&#x27;</span>;</span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(insertSql, [userInfo.<span class="property">accounts</span>, code, codeExpiresAt]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成功返回响应</span></span><br><span class="line">    res.<span class="title function_">cc</span>(<span class="string">&#x27;验证码已发送&#x27;</span>, <span class="number">0</span>); <span class="comment">// 0 表示成功状态</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title function_">next</span>(error); <span class="comment">// 把错误交给全局错误处理中间件处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>什么时候用 res.cc？</strong></p><ul><li><p><strong>用于轻量级的错误响应：</strong><br>如果某些错误逻辑不需要传递到全局错误处理中间件（例如简单的业务校验失败），可以直接使用 <code>res.cc</code>：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (!userInfo.accounts) &#123;</span><br><span class="line">  return res.cc(&#x27;手机号不能为空&#x27;, 1); // 不传递到错误处理中间件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>用于不可恢复的错误：</strong><br>如果错误是不可恢复的、需要全局处理的，应该使用 <code>next(error)</code>，让全局错误处理中间件处理。</p></li><li><p>不可恢复的错误（<strong>irrecoverable errors</strong>）是指那些在发生时无法通过常规的错误处理或重试机制来恢复的错误。这些错误通常意味着应用程序的某些关键部分已经崩溃或无法继续运行，因此程序需要停止执行并返回给用户适当的错误信息。常见的不可恢复错误可能涉及系统级别的问题、程序的逻辑错误或无法处理的外部资源故障。</p></li></ul><p><strong>总结</strong></p><ol><li><strong>res.cc 是响应辅助中间件，而非错误处理中间件</strong>。它用于简化成功或失败的响应逻辑，统一返回格式。</li><li><strong>错误处理中间件需要显式接收 err 参数</strong>。如果在业务逻辑中调用 <code>next(error)</code>，Express 会自动将错误传递给第一个错误处理中间件。</li><li><strong>两者结合</strong>：<code>res.cc</code> 和全局错误处理中间件搭配使用，可以让代码既简洁又结构清晰，推荐这样做。</li></ol>
              </div>
            </details>
<h2 id="7-为项目配置-eslint"><a href="#7-为项目配置-eslint" class="headerlink" title="7. 为项目配置 eslint"></a>7. 为项目配置 eslint</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>安装 &amp; 初始化</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm npm install eslint</span><br><span class="line"></span><br><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure></li><li><p>编辑<code>eslint.config.js</code>规则</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> globals <span class="keyword">from</span> <span class="string">&quot;globals&quot;</span></span><br><span class="line"><span class="keyword">import</span> pluginJs <span class="keyword">from</span> <span class="string">&quot;@eslint/js&quot;</span></span><br><span class="line"></span><br><span class="line"># rules 外层需要包一层对象</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;eslint&#x27;).Linter.Config[]</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;<span class="attr">files</span>: [<span class="string">&quot;**/*.js&quot;</span>], <span class="attr">languageOptions</span>: &#123;<span class="attr">sourceType</span>: <span class="string">&quot;commonjs&quot;</span>&#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">languageOptions</span>: &#123; <span class="attr">globals</span>: globals.<span class="property">browser</span> &#125;&#125;,</span><br><span class="line">  &#123;<span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;semi&quot;</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;never&quot;</span>],</span><br><span class="line">  &#125;&#125;,</span><br><span class="line">  pluginJs.<span class="property">configs</span>.<span class="property">recommended</span>,</span><br><span class="line">  </span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>详细说明 es6 和 commonjs 两个标准</p><p><code>module.exports = router</code> 和 <code>export default router</code> 的区别主要在于两者所属的模块系统和使用方式。它们分别属于 <strong>CommonJS</strong> 和 <strong>ES6 模块</strong> 两种模块规范。</p><hr><p> <strong>1. CommonJS 和 ES6 模块简介</strong></p><ul><li><strong>CommonJS</strong> 是 Node.js 默认的模块规范，使用 <code>require</code> 和 <code>module.exports</code>。</li><li><strong>ES6 模块</strong> 是 JavaScript 的现代模块系统，使用 <code>import</code> 和 <code>export</code>。</li></ul><hr><p> <strong>2. 区别分析</strong></p><p><strong>语法层面的区别</strong></p><ol><li><p><strong>CommonJS (module.exports)</strong></p><ul><li>使用 <code>module.exports</code> 导出。</li><li>使用 <code>require</code> 导入。</li></ul><p>示例：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导出文件（CommonJS）</span></span><br><span class="line"><span class="keyword">const</span> router = &#123;&#125;; <span class="comment">// 假设 router 是一个对象</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文件</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./path/to/router&#x27;</span>);</span><br></pre></td></tr></table></figure></li></ol></li></ol><ol><li><p><strong>ES6 模块 (export default)</strong></p><ul><li>使用 <code>export default</code> 导出。</li><li>使用 <code>import</code> 导入。</li></ul><p>示例：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导出文件（ES6 模块）</span></span><br><span class="line"><span class="keyword">const</span> router = &#123;&#125;; <span class="comment">// 假设 router 是一个对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入文件</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./path/to/router&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ol><hr><p><strong>运行时的区别</strong></p><ol><li><strong>CommonJS</strong><ul><li>模块在运行时加载，是同步的。</li><li><code>module.exports</code> 可以导出任何类型的值（对象、函数、数组、基本类型等）。</li><li>导入时，导出的是一个值的引用。</li></ul></li><li><strong>ES6 模块</strong><ul><li>模块在编译时解析，是静态的。</li><li><code>export default</code> 是 ES6 中默认导出方式，适用于一个模块导出一个主要功能。</li><li>导入时，支持 <code>import</code> 解构语法。</li><li>ES6 模块是严格模式，语法更现代。</li></ul></li></ol><hr><p><strong>项目中的区别</strong></p><ol><li><p><strong>兼容性</strong></p><ul><li><strong>Node.js 环境</strong>：Node.js 默认支持 CommonJS 模块。如果要使用 ES6 模块，需要将 <code>package.json</code> 的 <code>type</code> 设置为 <code>&quot;module&quot;</code>，或者使用 <code>.mjs</code> 文件扩展名。</li><li><strong>前端环境</strong>：现代前端工具（如 Webpack、Vite）对 ES6 模块有更好的支持。</li></ul></li><li><p><strong>导出多项功能</strong></p><ul><li><p>CommonJS 使用exports，可以导出多个成员：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">func1</span> = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">func2</span> = <span class="function">() =&gt;</span> &#123;&#125;;</span><br></pre></td></tr></table></figure></li><li><p>ES6 模块支持命名导出和默认导出：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">func1</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">func2</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure></li></ul></li></ol><ol><li><p><strong>使用习惯</strong></p><ul><li>CommonJS 更常用于后端（Node.js 项目）。</li><li>ES6 模块是现代 JavaScript 标准，前端项目和支持现代语法的后端项目更倾向于使用。</li></ul></li></ol><hr><p>   <strong>混用时的注意事项</strong></p><ol><li><p>如果一个模块使用 <code>module.exports</code> 导出，导入时不能直接用 <code>import</code>，需要借助 <code>createRequire</code> 或其他工具。</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRequire &#125; <span class="keyword">from</span> <span class="string">&#x27;module&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">require</span> = <span class="title function_">createRequire</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./path/to/router&#x27;</span>);</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>如果一个模块使用 <code>export default</code> 导出，<code>require</code> 导入时会被包装在 <code>default</code> 属性中：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导出文件（ES6 模块）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommonJS 导入</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./path/to/router&#x27;</span>).<span class="property">default</span>;</span><br></pre></td></tr></table></figure></li></ol><hr><p>   <strong>总结</strong></p><div class="table-container"><table><thead><tr><th>特性</th><th><code>module.exports</code> (CommonJS)</th><th><code>export default</code> (ES6 模块)</th></tr></thead><tbody><tr><td>模块规范</td><td>CommonJS</td><td>ES6 模块</td></tr><tr><td>使用的导入方式</td><td><code>require()</code></td><td><code>import</code></td></tr><tr><td>支持环境</td><td>Node.js 默认支持</td><td>需设置 <code>&quot;type&quot;: &quot;module&quot;</code> 或 <code>.mjs</code> 文件</td></tr><tr><td>导入方式</td><td>直接导入值</td><td>默认导出直接导入，支持解构</td></tr><tr><td>运行时或编译时</td><td>运行时加载（同步）</td><td>编译时解析（静态）</td></tr><tr><td>灵活性</td><td>可导出单个或多个对象</td><td>默认导出一个主要内容，可同时命名导出多个</td></tr></tbody></table></div><p>如果你在使用现代工具链或构建前端应用，<strong>优先使用 ES6 模块</strong>；而在传统 Node.js 项目中，<strong>CommonJS 更加直接和兼容性好</strong>。</p>
              </div>
            </details>
<h2 id="8-表单验证-escook-express-joi"><a href="#8-表单验证-escook-express-joi" class="headerlink" title="8.  表单验证 @escook/express-joi"></a>8.  表单验证 @escook/express-joi</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>安装</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pnpm i @escook/express-joi</span><br><span class="line"></span><br><span class="line">// 依赖</span><br><span class="line">pnpm i joi</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>导入，<code>app.js</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入 express</span></span><br><span class="line"><span class="keyword">const</span>  express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 创建 express 实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 Joi 模块</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Joi</span> = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 cors 跨域中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>())</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>新建 /schema/user.js 用户信息验证规则模块，并初始化以下代码</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Joi</span> = <span class="built_in">require</span>(<span class="string">&#x27;joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义手机号验证规则</span></span><br><span class="line"><span class="keyword">const</span> accounts = <span class="title class_">Joi</span>.<span class="title function_">string</span>().<span class="title function_">required</span>()</span><br><span class="line"><span class="keyword">const</span> code = <span class="title class_">Joi</span>.<span class="title function_">string</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义手机号码的验证规则</span></span><br><span class="line"><span class="keyword">const</span> reg_login_schema = &#123;</span><br><span class="line"><span class="attr">body</span>: &#123;</span><br><span class="line">accounts,</span><br><span class="line">code</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出 reg_login_schema</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; reg_login_schema &#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>然后 ，在路由模块中使用</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Router</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入验证数据的中间件</span></span><br><span class="line"><span class="keyword">const</span> expressJoi = <span class="built_in">require</span>(<span class="string">&#x27;@escook/express-joi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入需要的验证规则对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; reg_login_schema &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../schema/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入处理函数</span></span><br><span class="line"><span class="keyword">const</span> &#123; regUser, login &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login/code&#x27;</span>, <span class="title function_">expressJoi</span>(reg_login_schema), regUser)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line"><span class="comment">// 需要注意的是，多个路由共用验证规则时，要留意验证对象是否为必填</span></span><br><span class="line"><span class="comment">// 如果验证规则中没有某个数据的验证规则，但发起的请求中携带了该参数，则会导致 [Object: null prototype] 报错</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="title function_">expressJoi</span>(reg_login_schema), login)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出路由</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<h2 id="9-使用-fetch-加载本地json数据"><a href="#9-使用-fetch-加载本地json数据" class="headerlink" title="9. 使用 fetch 加载本地json数据"></a>9. 使用 fetch 加载本地json数据</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>public文件夹下，创建data/*.json文件</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span> </span><br><span class="line">  </span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/data/img/banner-1.png&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;it求职端2&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;isdelete&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mobile.zcwytd.com/#/pages/login/choice/index&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;create_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-06-28T13:03:53.000Z&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;update_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-07-05T08:48:55.000Z&quot;</span> </span><br><span class="line">     </span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;picture&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/data/img/banner-2.png&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;it求职端1&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;isdelete&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://mobile.zcwytd.com/#/pages/login/choice/index&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;create_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-06-28T13:05:33.000Z&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      </span><br><span class="line">      <span class="attr">&quot;update_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-07-01T06:34:11.000Z&quot;</span> </span><br><span class="line">     </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>修改原vue文件中的api请求逻辑</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是接口请求函数：</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getBannerList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 这里，原本是发起 api 请求</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">bannerList</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="number">2</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 这里也很有意思, if (res) &#123;&#125; else&#123;当中, 推断了 res 为 false, 因此不再允许使用已在 api 接口中定义的返回数据类型&#125;</span></span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">list</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    store.<span class="title function_">setBannerList</span>(res.<span class="property">list</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">showToast</span>(res.<span class="property">msg</span> || <span class="string">&#x27;到这里出错啦&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>现在，我们已经在前端项目中准备好了json数据，可以直接使用 fetch 从本地获取</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getBannerList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 fetch 从本地 JSON 文件加载数据</span></span><br><span class="line">    <span class="comment">// 假设文件在 public/data/banner.json</span></span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/data/banner.json&#x27;</span>) </span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;无法加载本地数据&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 JSON 文件解析为对象</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> response.<span class="title function_">json</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断并处理返回的数据</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">list</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">      store.<span class="title function_">setBannerList</span>(res.<span class="property">list</span>) <span class="comment">// 假设 store 是一个全局状态管理对象</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">showToast</span>(res.<span class="property">msg</span> || <span class="string">&#x27;数据格式不正确，缺少 list 字段&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载本地 bannerList 数据失败:&#x27;</span>, error)</span><br><span class="line">    <span class="title function_">showToast</span>(<span class="string">&#x27;加载本地数据出错&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>
              </div>
            </details>
<h2 id="10-开发阶段，向-mysql-数据库批量添加数据"><a href="#10-开发阶段，向-mysql-数据库批量添加数据" class="headerlink" title="10. 开发阶段，向 mysql 数据库批量添加数据"></a>10. 开发阶段，向 mysql 数据库批量添加数据</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <p>需求来了，前端项目demo需要的基础数据，需要批量添加到指定的数据库表当中</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 首先，准备数据</span></span><br><span class="line">  <span class="keyword">const</span> taskList = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;task_id&quot;</span>: <span class="number">33</span>, </span><br><span class="line">      <span class="string">&quot;task_name&quot;</span>: <span class="string">&quot;拯救喵星人&quot;</span>, </span><br><span class="line">      <span class="string">&quot;position_name&quot;</span>: <span class="string">&quot;前端开发&quot;</span>, </span><br><span class="line">      <span class="string">&quot;task_budget&quot;</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">&quot;task_cycle&quot;</span>: <span class="number">60</span>, </span><br><span class="line">      <span class="string">&quot;service_mode&quot;</span>: <span class="string">&quot;驻场&quot;</span>, </span><br><span class="line">      <span class="string">&quot;task_ask&quot;</span>: <span class="string">&quot;救救孩子吧&quot;</span>, </span><br><span class="line">      <span class="string">&quot;task_grade&quot;</span>: <span class="string">&quot;初级&quot;</span>, </span><br><span class="line">      <span class="string">&quot;isdelete&quot;</span>: <span class="number">0</span>, </span><br><span class="line">      <span class="string">&quot;is_check&quot;</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">&quot;company_name&quot;</span>: <span class="string">&quot;北京驻场无忧科技有限公司&quot;</span>, </span><br><span class="line">      <span class="string">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span>, </span><br><span class="line">      <span class="string">&quot;area&quot;</span>: <span class="string">&quot;朝阳区&quot;</span>, </span><br><span class="line">      <span class="string">&quot;user_name&quot;</span>: <span class="literal">null</span>, </span><br><span class="line">      <span class="string">&quot;it_head&quot;</span>: <span class="literal">null</span>, </span><br><span class="line">      <span class="string">&quot;is_emergency&quot;</span>: <span class="number">1</span> </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;task_id&quot;</span>: <span class="number">38</span>, </span><br><span class="line">        <span class="string">&quot;task_name&quot;</span>: <span class="string">&quot;金融行业app的一个小程序设计&quot;</span>, </span><br><span class="line">        <span class="string">&quot;position_name&quot;</span>: <span class="string">&quot;UI设计师&quot;</span>, </span><br><span class="line">        <span class="string">&quot;task_budget&quot;</span>: <span class="number">15000</span>, </span><br><span class="line">        <span class="string">&quot;task_cycle&quot;</span>: <span class="number">30</span>, </span><br><span class="line">        <span class="string">&quot;service_mode&quot;</span>: <span class="string">&quot;全职&quot;</span>, </span><br><span class="line">        <span class="string">&quot;task_ask&quot;</span>: <span class="string">&quot;金融行业的小程序设计，对ui界面要求很高，有完整的小程序开发者优先，能独立完成一整套小程序设计的流程，跟踪开发落地。&quot;</span>, </span><br><span class="line">        <span class="string">&quot;task_grade&quot;</span>: <span class="literal">null</span>, </span><br><span class="line">        <span class="string">&quot;isdelete&quot;</span>: <span class="number">0</span>, </span><br><span class="line">        <span class="string">&quot;is_check&quot;</span>: <span class="number">1</span>, </span><br><span class="line">        <span class="string">&quot;company_name&quot;</span>: <span class="string">&quot;北京驻场无忧科技有限公司&quot;</span>, </span><br><span class="line">        <span class="string">&quot;city&quot;</span>: <span class="string">&quot;北京&quot;</span>, </span><br><span class="line">        <span class="string">&quot;area&quot;</span>: <span class="string">&quot;朝阳区&quot;</span>, </span><br><span class="line">        <span class="string">&quot;user_name&quot;</span>: <span class="literal">null</span>, </span><br><span class="line">        <span class="string">&quot;it_head&quot;</span>: <span class="literal">null</span>, </span><br><span class="line">        <span class="string">&quot;is_emergency&quot;</span>: <span class="number">0</span> </span><br><span class="line">    	&#125;,</span><br><span class="line">  ]</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 定义查询字符串和数据数组</span></span><br><span class="line">  <span class="keyword">const</span> sql = <span class="string">`</span></span><br><span class="line"><span class="string">  INSERT INTO taskList (</span></span><br><span class="line"><span class="string">    task_name,</span></span><br><span class="line"><span class="string">    position_name,</span></span><br><span class="line"><span class="string">    task_budget,</span></span><br><span class="line"><span class="string">    task_cycle,</span></span><br><span class="line"><span class="string">    service_mode,</span></span><br><span class="line"><span class="string">    task_ask,</span></span><br><span class="line"><span class="string">    task_grade,</span></span><br><span class="line"><span class="string">    isdelete,</span></span><br><span class="line"><span class="string">    is_check,</span></span><br><span class="line"><span class="string">    company_name,</span></span><br><span class="line"><span class="string">    city,</span></span><br><span class="line"><span class="string">    area,</span></span><br><span class="line"><span class="string">    user_name,</span></span><br><span class="line"><span class="string">    it_head,</span></span><br><span class="line"><span class="string">    is_emergency,</span></span><br><span class="line"><span class="string">    created_at,</span></span><br><span class="line"><span class="string">    updated_at</span></span><br><span class="line"><span class="string">  ) VALUES ?</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">  <span class="comment">// 转换数据为批量插入格式</span></span><br><span class="line"><span class="keyword">const</span> values = taskList.<span class="title function_">map</span>(<span class="function"><span class="params">task</span> =&gt;</span> [</span><br><span class="line">  task.<span class="property">task_name</span>,</span><br><span class="line">  task.<span class="property">position_name</span>,</span><br><span class="line">  task.<span class="property">task_budget</span>,</span><br><span class="line">  task.<span class="property">task_cycle</span>,</span><br><span class="line">  task.<span class="property">service_mode</span>,</span><br><span class="line">  task.<span class="property">task_ask</span>,</span><br><span class="line">  task.<span class="property">task_grade</span>,</span><br><span class="line">  task.<span class="property">isdelete</span>,</span><br><span class="line">  task.<span class="property">is_check</span>,</span><br><span class="line">  task.<span class="property">company_name</span>,</span><br><span class="line">  task.<span class="property">city</span>,</span><br><span class="line">  task.<span class="property">area</span>,</span><br><span class="line">  task.<span class="property">user_name</span>,</span><br><span class="line">  task.<span class="property">it_head</span>,</span><br><span class="line">  task.<span class="property">is_emergency</span>,</span><br><span class="line">  task.<span class="property">created_at</span>,</span><br><span class="line">  task.<span class="property">updated_at</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行插入</span></span><br><span class="line">db.<span class="title function_">query</span>(sql, [values], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;批量插入数据失败:&#x27;</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 这里插入成功的提示貌似没有打印出来，但是已经验证，数据是批量注入了</span></span><br><span class="line">  <span class="comment">// 后面类似的操作会特别留意原因</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;批量插入数据成功:&#x27;</span>, result)</span><br><span class="line">  db.<span class="title function_">end</span>() <span class="comment">// 关闭连接</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">  res.<span class="title function_">cc</span>(error,<span class="number">500</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h2 id="11-jwt-token-验证"><a href="#11-jwt-token-验证" class="headerlink" title="11. jwt-token 验证"></a>11. jwt-token 验证</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>根据后端的 token 验证逻辑</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一定要在路由之前，应用此中间件</span></span><br><span class="line"><span class="keyword">const</span> &#123; expressjwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">expressjwt</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: config.<span class="property">jwtSecretKey</span>, <span class="comment">// 与生成 Token 时的密钥保持一致</span></span><br><span class="line">    <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>], <span class="comment">// 确保算法与 Token 的签名方式匹配</span></span><br><span class="line">    <span class="attr">getToken</span>: <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 从 x-access-token 提取 Token</span></span><br><span class="line">      <span class="keyword">const</span> token = req.<span class="property">headers</span>[<span class="string">&#x27;x-access-token&#x27;</span>]</span><br><span class="line">      <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">startsWith</span>(<span class="string">&#x27;Bearer &#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> token.<span class="title function_">slice</span>(<span class="number">7</span>) <span class="comment">// 去掉 &quot;Bearer &quot; 前缀</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).<span class="title function_">unless</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: [<span class="regexp">/^\/api\/login(\/.*)?$/</span>] <span class="comment">// 豁免登录相关接口</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>前端必须按照后端显示指定的 getToken 方法来携带token</p></li><li><p>不显示的指定行不行？行！</p><p>在使用 <code>express-jwt</code> 时，<code>getToken</code> 方法 <strong>不是必须显式指定</strong> 的，但它有一个默认的行为。如果不显式提供 <code>getToken</code>，<code>express-jwt</code> 会按照以下默认逻辑来提取 Token：</p><hr><p><strong>默认行为</strong></p><p><code>express-jwt</code> 默认从以下位置提取 Token：</p><ol><li><p>Authorization Header</p><ul><li>默认从请求头 <code>Authorization</code> 提取。</li><li>要求格式为：<code>Bearer &lt;token&gt;</code>。</li><li>例如：<code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR...</code></li></ul></li></ol><hr><p><strong>为什么要自定义 getToken？</strong></p><ol><li><strong>Token 来源不同</strong>:<ul><li>如果你的 Token <strong>不在 Authorization 头</strong>，而是放在其他地方（比如 <code>x-access-token</code> 或者 <code>cookie</code>），就需要通过 <code>getToken</code> 方法显式指定如何提取。</li></ul></li><li><strong>前缀不符合 Bearer 格式</strong>:<ul><li>如果你的 Token 没有 <code>Bearer</code>前缀，默认逻辑无法正确解析 Token，也需要自定义 <code>getToken</code>。</li></ul></li><li><strong>支持更多场景</strong>:<ul><li>比如同时支持 <code>Authorization</code> 和 <code>x-access-token</code> 两种提取方式，或者允许从请求体中提取 Token。</li></ul></li></ol><hr><p><strong>不显式指定的代码示例</strong></p><p>以下是只使用默认行为的代码：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">expressjwt</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: config.<span class="property">jwtSecretKey</span>,</span><br><span class="line">    <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>]</span><br><span class="line">  &#125;).<span class="title function_">unless</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: [<span class="regexp">/^\/api\/login(\/.*)?$/</span>] <span class="comment">// 豁免登录相关接口</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li><p>Token 提取方式</p><p>默认只从 <code>Authorization: Bearer &lt;token&gt;</code> 中提取。</p></li></ul><hr><p><strong>显式指定的必要性</strong></p><p>在如下的代码中，显式定义了 <code>getToken</code>：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">getToken</span>: <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = req.<span class="property">headers</span>[<span class="string">&#x27;x-access-token&#x27;</span>]; <span class="comment">// 自定义从 x-access-token 提取</span></span><br><span class="line">  <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">startsWith</span>(<span class="string">&#x27;Bearer &#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> token.<span class="title function_">slice</span>(<span class="number">7</span>); <span class="comment">// 去掉 &quot;Bearer &quot; 前缀</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用了 <code>x-access-token</code> 来传递 Token，这不是默认行为。</li><li>如果不指定 <code>getToken</code>，<code>express-jwt</code> 会尝试从 <code>Authorization</code> 头提取，导致找不到 Token 的问题。</li></ul><hr><p><strong>结论</strong></p><ol><li><strong>不显式指定时</strong>，<code>express-jwt</code> 默认从 <code>Authorization: Bearer &lt;token&gt;</code> 中提取 Token。</li><li>如果你的 Token <strong>不在默认位置</strong>，或者格式不匹配，<strong>必须显式指定 getToken 方法</strong>。</li></ol></li></ol><p>​    ps: 关于错误级别中间件的一些细节试错</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义错误级别中间件</span></span><br><span class="line"><span class="comment">// 这里必须要有 next(), 否则会导致中间件无法正常工作</span></span><br><span class="line"><span class="comment">// 例如，使用 apifox 工具时，未能正确执行 res.cc(&#x27;身份认证失败！&#x27;)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 数据验证失败</span></span><br><span class="line">  <span class="keyword">if</span> (err <span class="keyword">instanceof</span> <span class="title class_">Joi</span>.<span class="property">ValidationError</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(err)</span><br><span class="line">  <span class="comment">// 身份认证失败</span></span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">cc</span>(<span class="string">&#x27;身份认证失败！&#x27;</span>)</span><br><span class="line">  <span class="comment">// 未知错误</span></span><br><span class="line">  res.<span class="title function_">cc</span>(err)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err)</span><br><span class="line">  <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h2 id="12-温故知新，前端瀑布流加载数据的后端适配"><a href="#12-温故知新，前端瀑布流加载数据的后端适配" class="headerlink" title="12.温故知新，前端瀑布流加载数据的后端适配"></a>12.温故知新，前端瀑布流加载数据的后端适配</h2><details class="folding-tag" ><summary> 后端 api 设计 - 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>直接上代码</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 导入数据库操作模块</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/index&#x27;</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taskAllList</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 从前端请求中提取参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">      position_name, </span><br><span class="line">      service_mode, </span><br><span class="line">      task_cycle, </span><br><span class="line">      pageNum = <span class="number">1</span>,</span><br><span class="line">      pageSize = <span class="number">10</span>,</span><br><span class="line">      city </span><br><span class="line">    &#125; = req.<span class="property">query</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 基础查询语句</span></span><br><span class="line">    <span class="keyword">let</span> query = <span class="string">&#x27;SELECT * FROM tasklist WHERE isdelete = 0 AND is_check = 1&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> params = []</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 根据参数动态构建查询条件</span></span><br><span class="line">    <span class="keyword">if</span> (city) &#123;</span><br><span class="line">      query += <span class="string">&#x27; AND city = ?&#x27;</span></span><br><span class="line">      params.<span class="title function_">push</span>(city)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (position_name) &#123;</span><br><span class="line">      query += <span class="string">&#x27; AND position_name = ?&#x27;</span></span><br><span class="line">      params.<span class="title function_">push</span>(position_name)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (service_mode) &#123;</span><br><span class="line">      query += <span class="string">&#x27; AND service_mode = ?&#x27;</span></span><br><span class="line">      params.<span class="title function_">push</span>(service_mode)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (task_cycle) &#123;</span><br><span class="line">      query += <span class="string">&#x27; AND task_cycle &lt;= ?&#x27;</span></span><br><span class="line">      params.<span class="title function_">push</span>(task_cycle)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 添加排序条件（可选，视需求而定）</span></span><br><span class="line">    query += <span class="string">&#x27; ORDER BY created_at DESC&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 添加分页逻辑</span></span><br><span class="line">    <span class="keyword">const</span> offset = (pageNum - <span class="number">1</span>) * pageSize <span class="comment">// 计算偏移量</span></span><br><span class="line">    query += <span class="string">&#x27; LIMIT ? OFFSET ?&#x27;</span></span><br><span class="line">    params.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(pageSize), <span class="built_in">parseInt</span>(offset))</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 执行 SQL 查询</span></span><br><span class="line">    <span class="keyword">const</span> [rows] = <span class="keyword">await</span> db.<span class="title function_">query</span>(query, params)</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 查询总数（不带分页条件的总记录数）</span></span><br><span class="line">    <span class="keyword">const</span> totalQuery = <span class="string">&#x27;SELECT COUNT(*) AS total FROM tasklist WHERE isdelete = 0 AND is_check = 1&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> [totalResult] = <span class="keyword">await</span> db.<span class="title function_">query</span>(totalQuery,params)</span><br><span class="line">    <span class="keyword">const</span> total = totalResult[<span class="number">0</span>].<span class="property">total</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 响应数据</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">result</span>: &#123;</span><br><span class="line">        <span class="attr">records</span>: rows, <span class="comment">// 当前页的记录</span></span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;查询任务列表成功！&#x27;</span>,</span><br><span class="line">        total, <span class="comment">// 总记录数</span></span><br><span class="line">        <span class="attr">page</span>: <span class="built_in">parseInt</span>(pageNum), <span class="comment">// 当前页码</span></span><br><span class="line">        <span class="attr">pageSize</span>: <span class="built_in">parseInt</span>(pageSize) <span class="comment">// 每页条数</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">   &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    res.<span class="title function_">cc</span>(e) <span class="comment">// 捕获并返回错误</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><strong>代码中的分页逻辑</strong></li></ol>   <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 分页相关参数</span></span><br><span class="line"><span class="keyword">const</span> offset = (pageNum - <span class="number">1</span>) * pageSize; <span class="comment">// 计算偏移量</span></span><br><span class="line">query += <span class="string">&#x27; LIMIT ? OFFSET ?&#x27;</span>;</span><br><span class="line">params.<span class="title function_">push</span>(<span class="built_in">parseInt</span>(pageSize), <span class="built_in">parseInt</span>(offset));</span><br></pre></td></tr></table></figure><ol><li><p><strong>参数定义：</strong></p><ul><li><code>pageNum</code>: 当前页码（从前端请求中传入，默认值为 <code>1</code>）。</li><li><code>pageSize</code>: 每页显示的记录条数（从前端请求中传入，默认值为 <code>10</code>）。</li><li><code>offset</code>: 偏移量，即查询从哪一条记录开始。</li></ul></li><li><p><strong>偏移量的计算：</strong></p><ul><li><p><strong>公式：</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1736856432895.png" alt="计算偏移量"></p><ul><li><code>pageNum - 1</code>: 计算从第几页开始，第一页 <code>pageNum=1</code> 时，偏移量为 <code>0</code>。</li><li>乘以 <code>pageSize</code>: 确定要跳过的记录条数。</li></ul></li><li><p><strong>示例：</strong></p><ul><li>假设每页显示 10 条记录：<ul><li>第 1 页：<code>offset = (1 - 1) * 10 = 0</code>（从第 0 条记录开始）。</li><li>第 2 页：<code>offset = (2 - 1) * 10 = 10</code>（从第 10 条记录开始）。</li><li>第 3 页：<code>offset = (3 - 1) * 10 = 20</code>（从第 20 条记录开始）。</li></ul></li></ul></li></ul></li><li><p><strong>SQL 中的分页：</strong></p><ul><li><p><strong>LIMIT ?</strong>: 限制返回的记录条数，<code>pageSize</code> 决定每页的记录数量。</p></li><li><p><strong>OFFSET ?</strong>: 跳过指定数量的记录，<code>offset</code> 决定从哪一条记录开始。</p></li><li><p><strong>完整示例 SQL：</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tasklist </span><br><span class="line"><span class="keyword">WHERE</span> isdelete <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> is_check <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">10</span> <span class="keyword">OFFSET</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><ul><li>每页显示 <code>10</code> 条记录，跳过前 <code>20</code> 条（即返回第 21~30 条记录）。</li></ul></li></ul></li></ol><hr><p>   <strong>查询总数（Total）逻辑</strong></p><p>   分页需要知道总记录数，以便前端计算分页按钮或判断是否加载更多数据。</p>   <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">const totalQuery <span class="operator">=</span> <span class="string">&#x27;SELECT COUNT(*) AS total FROM tasklist WHERE isdelete = 0 AND is_check = 1&#x27;</span>;</span><br><span class="line">const [totalResult] <span class="operator">=</span> await db.query(totalQuery);</span><br><span class="line">const total <span class="operator">=</span> totalResult[<span class="number">0</span>].total;</span><br></pre></td></tr></table></figure><ol><li><p><strong>SQL 查询解释：</strong></p><ul><li><strong>SELECT COUNT(*) AS total</strong>: 统计 <code>tasklist</code> 表中符合条件的总记录数。</li><li><strong>WHERE 条件</strong>: 只统计未被删除且已审核的记录。</li><li>不受 <code>LIMIT</code> 和 <code>OFFSET</code> 限制，返回的是完整数据集的记录总数。</li></ul></li><li><p><strong>结果意义：</strong></p><ul><li><p><code>total</code>: 总记录数，供前端分页使用。</p></li><li><p>前端可以用以下公式计算总页数：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="1736821427654.png" alt="计算总数"></p></li></ul></li></ol><hr><p>   <strong>分页的工作流程</strong></p><ol><li><strong>前端传参：</strong><ul><li>用户请求某一页数据，前端发送参数：<code>pageNum</code> 和 <code>pageSize</code>。</li></ul></li><li><strong>后端接收：</strong><ul><li>通过 <code>pageNum</code> 和 <code>pageSize</code> 计算 <code>offset</code>。</li><li>使用 <code>LIMIT</code> 和 <code>OFFSET</code> 限制返回的记录条数。</li></ul></li><li><strong>返回数据：</strong><ul><li>返回分页数据（<code>rows</code>）和总记录数（<code>total</code>）。</li><li>前端可以根据 <code>total</code> 决定是否还有更多数据。</li></ul></li></ol><hr><p>   <strong>注意事项</strong></p><ol><li><p><strong>性能优化：</strong></p><ul><li>当数据量很大时，直接使用 <code>OFFSET</code> 可能导致性能问题，因为数据库需要跳过大量数据。</li><li><strong>优化方法</strong>：通过索引字段（如 <code>id</code> 或 <code>created_at</code>）使用游标进行分页查询。</li></ul><p><strong>示例：</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> tasklist </span><br><span class="line"><span class="keyword">WHERE</span> isdelete <span class="operator">=</span> <span class="number">0</span> <span class="keyword">AND</span> is_check <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> id <span class="operator">&gt;</span> ? </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id <span class="keyword">ASC</span> </span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure></li><li><p><strong>边界情况处理：</strong></p><ul><li><code>pageNum</code> 小于 1：将其修正为 <code>1</code>。</li><li><code>pageSize</code> 超过合理范围：设置最大值（如 <code>100</code>）。</li><li>总数为 <code>0</code> 时：返回空数据，并标记分页已完成。</li></ul></li></ol><hr><p>   <strong>总结</strong></p><p>   分页逻辑的核心是通过 <code>LIMIT</code> 和 <code>OFFSET</code> 控制查询范围，并通过计算偏移量确定从哪一条记录开始查询。通过统计总记录数，确保前端能够正确显示分页状态或终止加载更多的逻辑。</p>
              </div>
            </details>
<h2 id="13-按照范式标准，创建用户收藏表"><a href="#13-按照范式标准，创建用户收藏表" class="headerlink" title="13. 按照范式标准，创建用户收藏表"></a>13. 按照范式标准，创建用户收藏表</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <ol><li><p>首先，创建数据库表</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> task_favorites (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,        <span class="comment">-- 主键</span></span><br><span class="line">    accounts <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,                     <span class="comment">-- 用户ID（外键关联用户表）</span></span><br><span class="line">    task_id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,                     <span class="comment">-- 任务ID（外键关联任务表）</span></span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="comment">-- 收藏时间</span></span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY (accounts, task_id),            <span class="comment">-- 用户和任务的唯一关系，防止重复收藏</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (accounts) <span class="keyword">REFERENCES</span> users(accounts) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE, <span class="comment">-- 外键关联用户表</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (task_id) <span class="keyword">REFERENCES</span> tasklist(task_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE <span class="comment">-- 外键关联任务表</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li><code>user_id</code> 和 <code>task_id</code> 使用外键关联 <code>users</code> 表和 <code>tasklist</code> 表，保证数据的一致性。</li><li><code>UNIQUE KEY (user_id, task_id)</code> 防止同一用户对同一任务重复收藏。</li><li><code>ON DELETE CASCADE</code> 确保父表删除对应记录时，自动删除 <code>user_favorites</code> 表中相关的关联数据。</li></ul><p>外键关联任务表：</p><ul><li><p>在 <code>FOREIGN KEY (task_id) REFERENCES tasklist(id) ON DELETE CASCADE</code> 中：</p><p><strong>tasklist</strong>：表示外键所引用的目标表名称，即这里的 <code>tasklist</code> 是任务表。</p><p><strong>task_id</strong>：表示 <code>tasklist</code> 表中的主键（Primary Key）。它是目标表的列名称，用来唯一标识 <code>tasklist</code> 表中的每一行数据。</p></li><li><p>意义是确保<code>task_id</code>的值只能是<code>tasklist</code>表中<code>task_id</code>列中已经存在的值，从而维持数据的一致性和完整性。</p><p>如果尝试向<code>task_favorites</code>表中插入<code>tasklist</code>中不存在的<code>task_id</code>记录，就会报错..</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ERROR <span class="number">1452</span> (<span class="number">23000</span>): Cannot <span class="keyword">add</span> <span class="keyword">or</span> <span class="keyword">update</span> a child <span class="type">row</span>: a <span class="keyword">foreign</span> key <span class="keyword">constraint</span> fails</span><br></pre></td></tr></table></figure></li></ul><p>创建外键关联任务表之前，需要做一些准备工作</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> 为指定列创建索引</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_accounts <span class="keyword">ON</span> users(accounts);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_task_id <span class="keyword">ON</span> tasklist(task_id);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>封装添加收藏关系的接口</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 任务收藏接口</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taskFavorite</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; task_id &#125; = req.<span class="property">body</span> <span class="comment">// 从请求的查询参数中获取任务ID</span></span><br><span class="line">  <span class="keyword">const</span> &#123; accounts &#125; = req.<span class="property">auth</span> <span class="comment">// 从请求的认证信息中获取用户账户（user_id）</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 查询当前用户是否已收藏该任务</span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;SELECT * FROM task_favorites WHERE accounts = ? AND task_id = ?&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> [rows] = <span class="keyword">await</span> db.<span class="title function_">query</span>(sql, [accounts, task_id])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rows.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 如果已收藏，则执行取消收藏</span></span><br><span class="line">      <span class="keyword">const</span> sqlDelete = <span class="string">&#x27;DELETE FROM task_favorites WHERE accounts = ? AND task_id = ?&#x27;</span></span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlDelete, [accounts, task_id])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回取消收藏的状态</span></span><br><span class="line">      res.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">        <span class="attr">result</span>: &#123;</span><br><span class="line">          <span class="attr">errCode</span>: <span class="number">200</span>,</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;已取消收藏&#x27;</span>,</span><br><span class="line">          <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="number">0</span> <span class="comment">// 收藏状态为 0，表示未收藏</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果未收藏，则执行添加收藏</span></span><br><span class="line">      <span class="keyword">const</span> sqlInsert = <span class="string">&#x27;INSERT INTO task_favorites (accounts, task_id) VALUES (?, ?)&#x27;</span></span><br><span class="line">      <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlInsert, [accounts, task_id])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 返回添加收藏的状态</span></span><br><span class="line">      res.<span class="title function_">send</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="string">&#x27;ok&#x27;</span>,</span><br><span class="line">        <span class="attr">result</span>: &#123;</span><br><span class="line">          <span class="attr">errCode</span>: <span class="number">200</span>,</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;已添加收藏&#x27;</span>,</span><br><span class="line">          <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="number">1</span> <span class="comment">// 收藏状态为 1，表示已收藏</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="comment">// 处理错误</span></span><br><span class="line">    res.<span class="title function_">cc</span>(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里需要注意一下，前端携带参数发起 post 请求，后端接收时，需要使用req.body进行接收，否则接收不到。</p></li></ol><details class="folding-tag" ><summary> 顺便说一下 </summary>              <div class='content'>              <ol><li><p>不同api请求方式的参数接收方式</p><p><strong>GET 请求</strong>：参数通过 URL 查询字符串（<code>req.query</code>）传递。</p><p><strong>POST 请求</strong>：参数通过请求体（<code>req.body</code>）传递。</p><p><strong>PUT 请求</strong>：参数通过请求体（<code>req.body</code>）传递，路径参数通过 <code>req.params</code> 获取。</p><p><strong>DELETE 请求</strong>：参数通常通过路径参数（<code>req.params</code>）传递，少量使用请求体。</p></li></ol><p><strong>特殊情况：POST 请求的 JSON 数据</strong></p><p>对于 <code>POST</code> 请求，如果发送的是 JSON 数据，后端需要使用中间件来解析请求体中的 JSON 数据。例如在 Express 中，使用 <code>express.json()</code> 来解析 JSON 数据。</p>              </div>            </details>
              </div>
            </details>
<h2 id="14-使用联合查询，合并需要返回的数据"><a href="#14-使用联合查询，合并需要返回的数据" class="headerlink" title="14.使用联合查询，合并需要返回的数据"></a>14.使用联合查询，合并需要返回的数据</h2><details class="folding-tag" ><summary> 点击查看详情 </summary>
              <div class='content'>
              <div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">首先从请求头中获取目标信息</button><button type="button" class="tab">编写联合查询逻辑</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>将从请求头中获取用户信息的逻辑设计为一个中间件</strong></p><p>在根目录创建 /utils/handleToken.js</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleToken</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 从请求头的 &#x27;x-access-token&#x27; 中获取 token</span></span><br><span class="line">  <span class="keyword">let</span> token = req.<span class="property">headers</span>[<span class="string">&#x27;x-access-token&#x27;</span>] || req.<span class="property">headers</span>[<span class="string">&#x27;authorization&#x27;</span>] <span class="comment">// 支持两种方式获取 Token</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果存在 Token 且包含 &#x27;Bearer &#x27; 前缀</span></span><br><span class="line">  <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">startsWith</span>(<span class="string">&#x27;Bearer &#x27;</span>)) &#123;</span><br><span class="line">    token = token.<span class="title function_">slice</span>(<span class="number">7</span>, token.<span class="property">length</span>) <span class="comment">// 移除 &#x27;Bearer &#x27; 前缀</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123; <span class="attr">code</span>: <span class="number">401</span>, <span class="attr">msg</span>: <span class="string">&#x27;缺少 token，认证失败&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 替换为你的 JWT 密钥</span></span><br><span class="line">    <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, config.<span class="property">jwtSecretKey</span>)</span><br><span class="line">    req.<span class="property">accounts</span> = decoded.<span class="property">accounts</span> <span class="comment">// 将解析出的用户信息存入 req 对象</span></span><br><span class="line">    <span class="title function_">next</span>() <span class="comment">// 继续处理请求</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Token 验证失败:&#x27;</span>, err)</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123; <span class="attr">code</span>: <span class="number">401</span>, <span class="attr">msg</span>: <span class="string">&#x27;无效的 token&#x27;</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; handleToken &#125;</span><br></pre></td></tr></table></figure><p>然后，在对应路由中添加该中间件</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Router</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> router = <span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; handleToken &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../utils/handleToken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入处理函数</span></span><br><span class="line"><span class="keyword">const</span> &#123; taskAllList,taskDetail,hotSearch &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../router_handler/task&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载路由</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/task/taskAllList&#x27;</span>,taskAllList)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在请求任务详情之前验证 token</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/task/getTaskDetails&#x27;</span>,handleToken,taskDetail)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/position/public/getHotSeach&#x27;</span>,hotSearch)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出路由</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure><p>然后，在处理逻辑中，就可以直接进行接收了  /</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> accounts = req.<span class="property">accounts</span></span><br></pre></td></tr></table></figure><p>其实吧，在 app.js 中，有如下一个中间件了解一下</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一定要在路由之前，应用此中间件</span></span><br><span class="line"><span class="keyword">const</span> &#123; expressjwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">  <span class="title function_">expressjwt</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: config.<span class="property">jwtSecretKey</span>, <span class="comment">// 与生成 Token 时的密钥保持一致</span></span><br><span class="line">    <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>], <span class="comment">// 确保算法与 Token 的签名方式匹配</span></span><br><span class="line">    <span class="attr">getToken</span>: <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 从 x-access-token 提取 Token</span></span><br><span class="line">      <span class="keyword">const</span> token = req.<span class="property">headers</span>[<span class="string">&#x27;x-access-token&#x27;</span>]</span><br><span class="line">      <span class="keyword">if</span> (token &amp;&amp; token.<span class="title function_">startsWith</span>(<span class="string">&#x27;Bearer &#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> token.<span class="title function_">slice</span>(<span class="number">7</span>) <span class="comment">// 去掉 &quot;Bearer &quot; 前缀</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).<span class="title function_">unless</span>(&#123;</span><br><span class="line">    <span class="attr">path</span>: [<span class="regexp">/^\/api\/login(\/.*)?$/</span>] <span class="comment">// 豁免登录相关接口</span></span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p> <code>express-jwt</code> 中间件在验证 Token 成功后，自动为当前请求对象 <code>req</code> 添加的一个属性，即req.auth。这个属性存储的是解析后的 JWT <strong>Payload</strong> 数据（也就是在生成 Token 时嵌入的用户信息），因此，可以对其进行解构以获取目标信息：</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; accounts &#125; = req.<span class="property">auth</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>/router_handle/task.js</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 任务详情接口</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">taskDetail</span> = <span class="keyword">async</span> (<span class="params">req, res</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 从中间件中接受解析出的 accounts</span></span><br><span class="line">    <span class="comment">// const accounts = req.accounts</span></span><br><span class="line">    <span class="comment">// 从请求参数中解构出来要查询的任务id</span></span><br><span class="line">    <span class="keyword">const</span> &#123; task_id &#125; = req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">const</span> &#123; accounts &#125; = req.<span class="property">auth</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!accounts) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123; <span class="attr">code</span>: <span class="number">401</span>, <span class="attr">msg</span>: <span class="string">&#x27;用户未登录或无效 token&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询任务详情的SQL语句</span></span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;SELECT * FROM tasklist WHERE task_id = ?&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询任务详情的SQL语句</span></span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> db.<span class="title function_">query</span>(sql, task_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> taskDetail = result[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询收藏关系的 sql 语句</span></span><br><span class="line">    <span class="keyword">const</span> sqlFavorite = <span class="string">&#x27;SELECT * FROM task_favorites WHERE accounts = ? AND task_id = ?&#x27;</span></span><br><span class="line">    <span class="comment">// 执行查询收藏关系</span></span><br><span class="line">    <span class="keyword">const</span> [favoriteResult] = <span class="keyword">await</span> db.<span class="title function_">query</span>(sqlFavorite, [accounts, task_id])</span><br><span class="line">    <span class="comment">// 根据查询结果，设置 status 值</span></span><br><span class="line">    <span class="keyword">const</span> status = favoriteResult.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1 表示已收藏，0 表示未收藏</span></span><br><span class="line">    <span class="comment">// 响应查询结果</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">result</span>: &#123;</span><br><span class="line">        <span class="attr">records</span>: [&#123;</span><br><span class="line">          ...taskDetail,</span><br><span class="line">          status</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;查询任务详情成功！&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    res.<span class="title function_">cc</span>(e) <span class="comment">// 捕获并返回错误</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>
              </div>
            </details>
<h2 id="100-这里必须留一个小尾巴，否则，编辑软件会报错，后面视情况会寻找原因，大概率是编辑器原因！"><a href="#100-这里必须留一个小尾巴，否则，编辑软件会报错，后面视情况会寻找原因，大概率是编辑器原因！" class="headerlink" title="100. 这里必须留一个小尾巴，否则，编辑软件会报错，后面视情况会寻找原因，大概率是编辑器原因！"></a>100. 这里必须留一个小尾巴，否则，编辑软件会报错，后面视情况会寻找原因，大概率是编辑器原因！</h2><p>ttttt 不会错版了kugei</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>双招项目后端api全过程实现</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://youruilin.github.io/posts/629f32c0/">https://youruilin.github.io/posts/629f32c0/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>游瑞林</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2024-12-29</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2025-07-22</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF/">后端</a><a class="post-meta__tags" href="/tags/api/">api</a></div><div class="post-share"><div class="social-share" data-image="http://lychee.iooio.cn:9527/uploads/medium/38/53/e2ec8d2bd090dd1321fa01254923.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/posts/2d02f8e2/" title="移植安知鱼中控台"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">前へ</div><div class="prev_info">移植安知鱼中控台</div></div></a><a class="next-post pull-right" href="/posts/2b6a0f4d/" title="大事件项目后端api全过程实现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">次へ</div><div class="next_info">大事件项目后端api全过程实现</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>関連記事</span></div><div class="relatedPosts-list"><a href="/posts/2b6a0f4d/" title="大事件项目后端api全过程实现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-29</div><div class="title">大事件项目后端api全过程实现</div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> コメント</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目次</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">1.初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA-mysql-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">2.创建 mysql 数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%B8%BA%E9%A1%B9%E7%9B%AE%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85-mysql2-%E6%A8%A1%E5%9D%97"><span class="toc-text">3.为项目后端项目安装 mysql2 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-text">4.登录模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6-res-cc"><span class="toc-text">5.定义一个全局中间件 res.cc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%A8%E5%B1%80%E9%94%99%E8%AF%AF%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">6.全局错误中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%B8%BA%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE-eslint"><span class="toc-text">7. 为项目配置 eslint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81-escook-express-joi"><span class="toc-text">8.  表单验证 @escook&#x2F;express-joi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E4%BD%BF%E7%94%A8-fetch-%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0json%E6%95%B0%E6%8D%AE"><span class="toc-text">9. 使用 fetch 加载本地json数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5%EF%BC%8C%E5%90%91-mysql-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-text">10. 开发阶段，向 mysql 数据库批量添加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-jwt-token-%E9%AA%8C%E8%AF%81"><span class="toc-text">11. jwt-token 验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0%EF%BC%8C%E5%89%8D%E7%AB%AF%E7%80%91%E5%B8%83%E6%B5%81%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9A%84%E5%90%8E%E7%AB%AF%E9%80%82%E9%85%8D"><span class="toc-text">12.温故知新，前端瀑布流加载数据的后端适配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E6%8C%89%E7%85%A7%E8%8C%83%E5%BC%8F%E6%A0%87%E5%87%86%EF%BC%8C%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%94%B6%E8%97%8F%E8%A1%A8"><span class="toc-text">13. 按照范式标准，创建用户收藏表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E4%BD%BF%E7%94%A8%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%EF%BC%8C%E5%90%88%E5%B9%B6%E9%9C%80%E8%A6%81%E8%BF%94%E5%9B%9E%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-text">14.使用联合查询，合并需要返回的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#100-%E8%BF%99%E9%87%8C%E5%BF%85%E9%A1%BB%E7%95%99%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%B0%BE%E5%B7%B4%EF%BC%8C%E5%90%A6%E5%88%99%EF%BC%8C%E7%BC%96%E8%BE%91%E8%BD%AF%E4%BB%B6%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E5%90%8E%E9%9D%A2%E8%A7%86%E6%83%85%E5%86%B5%E4%BC%9A%E5%AF%BB%E6%89%BE%E5%8E%9F%E5%9B%A0%EF%BC%8C%E5%A4%A7%E6%A6%82%E7%8E%87%E6%98%AF%E7%BC%96%E8%BE%91%E5%99%A8%E5%8E%9F%E5%9B%A0%EF%BC%81"><span class="toc-text">100. 这里必须留一个小尾巴，否则，编辑软件会报错，后面视情况会寻找原因，大概率是编辑器原因！</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">魔改指南</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/box/Gallery/">我的画廊</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/site/time/">建设进程</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener" href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/avatar.webp" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://tzy1997.com/" title="唐志远の博客"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/02/626f92e193879.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://akilar.top/" title="Akilarの糖果屋"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/6bf1ed05796db59c.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://butterfly.js.org/" title="Butterfly"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/64cc6a7d508026e1.png" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://anzhiy.cn/" title="安知鱼"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.bitiful.net/img/anzhiyu.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://akilar.top/link/" title="Acozycotage"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://akilar.top/img/siteicon/favicon.png" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://blog.bywind.xyz/" title="随风起"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog.bywind.xyz/img/avatar.png" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="张洪"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/12/28/63ac2812183aa.png" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2019 - 2025</b></span><span><b>&nbsp;&nbsp;By 游瑞林</b></span></div><div class="framework-info"><span>フレームワーク </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>テーマ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v7.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v5.0.0-b1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="本站采用双线部署，默认线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="本站采用双线部署，联通线路托管于Coding"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="本站使用网盾星球提供CDN加速与防护"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-网盾星球-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="読書モード"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="簡体字と繁体字の切り替え">繁</button><a class="icon-V hidden" onclick="switchNightMode()" title="ライトモード/ダークモード切り替え"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="シングルカラムとダブルカラムの切り替え"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="コメントへ移動"><i class="fas fa-comments"></i></a><button id="hide-aside-btn" type="button" title="シングルカラムとダブルカラムの切り替え"><i class="fas fa-arrows-alt-h"></i></button><button class="close" id="mobile-toc-button" type="button" title="目次"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="トップに戻る"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-zeta-coral.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-zeta-coral.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/random.js"></script><script src="//at.alicdn.com/t/c/font_4684778_183q7j85b02.js"></script><script defer src="/js/runtime.js"></script><script defer src="/js/tooltip.js"></script><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script defer data-pjax src="/js/txmap.js"></script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script async src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn.jsdelivr.net/npm/element-ui@2.15.6/lib/index.js"></script><script defer src="/js/custom.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/cursor.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/8.19.0/sweetalert2.all.min.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script src="/js/sun_moon.js" async></script><script src="/js/f12.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script async src="/js/console.js"></script><script data-pjax src="/js/nav.js"></script><script async src="/js/fps.js"></script><script async src="/js/title.js"></script><script async data-pjax src="/js/meting_js.js"></script><script async data-pjax src="/js/music.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

const triggerPjaxFn = (val) => {
  if (!val) return
  Object.values(val).forEach(fn => { fn() })
}

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjaxSendOnce')
  btf.removeGlobalFnEvent('themeChange')

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  triggerPjaxFn(window.globalFn.pjaxSend)
})

document.addEventListener('pjax:complete', () => {
  btf.removeGlobalFnEvent('pjaxCompleteOnce')
  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  triggerPjaxFn(window.globalFn.pjaxComplete)
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">検索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  データベースを読み込んでいます</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://youruilin.github.io/categories/日语/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 日本語能力練習している (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://youruilin.github.io/categories/hexo/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 hexo_blog 搭建全过程 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://youruilin.github.io/categories/前端开发/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱‍👓 Vite + vue3 + ts 双端招聘项目 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://youruilin.github.io/categories/git/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 git 相关 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://youruilin.github.io/categories/后端/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 后端 api_server (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://youruilin.github.io/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #49b1f5}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/d711a81c/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.com/youruilin/pic_bed/blob/main/bcg_img/%E5%92%8C%E9%A3%8E%E5%B7%A5%E4%BD%9C%E5%8F%B0%E9%9D%A2.jpg?raw=true" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-19</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/d711a81c/&quot;);" href="javascript:void(0);" alt="">日本語勉強している·頑張れ！</a><div class="blog-slider__text">记录学习日语的全过程, 保持不断地学习..</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/d711a81c/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/629f32c0/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/medium/38/53/e2ec8d2bd090dd1321fa01254923.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-07-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/629f32c0/&quot;);" href="javascript:void(0);" alt="">双招项目后端api全过程实现</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/629f32c0/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/7f37c772/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://lychee.iooio.cn:9527/uploads/original/3d/44/667fa779ad75e6062e263075a028.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-07-22</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/7f37c772/&quot;);" href="javascript:void(0);" alt="">ec2使用docker部署lychee图床全过程记录</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/7f37c772/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"log":false});</script></body></html>